{"version":3,"sources":["webpack://PDFAnnotate/webpack/universalModuleDefinition","webpack://PDFAnnotate/webpack/bootstrap","webpack://PDFAnnotate/./node_modules/events/events.js","webpack://PDFAnnotate/./node_modules/create-stylesheet/index.js","webpack://PDFAnnotate/./node_modules/object-assign/index.js","webpack://PDFAnnotate/./src/utils/abstractFunction.js","webpack://PDFAnnotate/./src/UI/utils.js","webpack://PDFAnnotate/./src/UI/event.js","webpack://PDFAnnotate/./src/adapter/StoreAdapter.js","webpack://PDFAnnotate/./src/utils/uuid.js","webpack://PDFAnnotate/./src/adapter/LocalStoreAdapter.js","webpack://PDFAnnotate/./src/utils/setAttributes.js","webpack://PDFAnnotate/./src/utils/normalizeColor.js","webpack://PDFAnnotate/./src/render/renderRect.js","webpack://PDFAnnotate/./src/render/appendChild.js","webpack://PDFAnnotate/./src/render/renderLine.js","webpack://PDFAnnotate/./src/render/renderPoint.js","webpack://PDFAnnotate/./src/render/renderText.js","webpack://PDFAnnotate/./src/render/renderPath.js","webpack://PDFAnnotate/./src/a11y/createScreenReaderOnly.js","webpack://PDFAnnotate/./src/a11y/insertElementWithinElement.js","webpack://PDFAnnotate/./src/a11y/insertElementWithinChildren.js","webpack://PDFAnnotate/./src/a11y/insertScreenReaderComment.js","webpack://PDFAnnotate/./src/a11y/renderScreenReaderComments.js","webpack://PDFAnnotate/./src/a11y/insertScreenReaderHint.js","webpack://PDFAnnotate/./src/a11y/initEventHandlers.js","webpack://PDFAnnotate/./src/a11y/renderScreenReaderHints.js","webpack://PDFAnnotate/./src/UI/edit.js","webpack://PDFAnnotate/./src/UI/pen.js","webpack://PDFAnnotate/./src/UI/point.js","webpack://PDFAnnotate/./src/UI/rect.js","webpack://PDFAnnotate/./src/UI/text.js","webpack://PDFAnnotate/./src/UI/page.js","webpack://PDFAnnotate/./src/UI/index.js","webpack://PDFAnnotate/./src/PDFJSAnnotate.js","webpack://PDFAnnotate/./src/render/index.js","webpack://PDFAnnotate/./index.js"],"names":["root","factory","exports","module","define","amd","window","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","ReflectOwnKeys","R","Reflect","ReflectApply","apply","target","receiver","args","Function","ownKeys","getOwnPropertySymbols","getOwnPropertyNames","concat","NumberIsNaN","Number","isNaN","EventEmitter","init","this","once","emitter","Promise","resolve","reject","eventListener","undefined","errorListener","removeListener","slice","arguments","err","_events","_eventsCount","_maxListeners","defaultMaxListeners","checkListener","listener","TypeError","_getMaxListeners","that","_addListener","type","prepend","events","existing","warning","newListener","emit","unshift","push","length","warned","w","Error","String","count","console","warn","onceWrapper","fired","wrapFn","_onceWrap","state","wrapped","_listeners","unwrap","evlistener","arr","ret","Array","unwrapListeners","arrayClone","listenerCount","copy","set","arg","RangeError","getPrototypeOf","setMaxListeners","getMaxListeners","doError","error","er","message","context","handler","len","listeners","addListener","on","prependListener","prependOnceListener","list","position","originalListener","shift","index","pop","spliceOne","off","removeAllListeners","keys","rawListeners","eventNames","blocks","style","document","createElement","text","map","selector","block","prop","replace","match","toLowerCase","hyphenate","processDeclaration","join","processDeclarationBlock","processRuleSet","setAttribute","appendChild","createTextNode","propIsEnumerable","propertyIsEnumerable","toObject","val","assign","test1","test2","fromCharCode","test3","split","forEach","letter","shouldUseNative","source","from","symbols","to","abstractFunction","userSelectStyleSheet","createStyleSheet","body","findSVGAtPoint","x","y","elements","querySelectorAll","el","pointIntersectsRect","getBoundingClientRect","rect","top","bottom","left","right","getOffsetAnnotationRect","getAnnotationRect","getOffset","offsetLeft","offsetTop","h","nodeName","minX","maxX","minY","maxY","getAttribute","splice","parseInt","LINE_OFFSET","height","width","result","includes","scaleUp","svg","viewport","getMetadata","scale","scaleDown","parentNode","toUpperCase","disableUserSelect","head","enableUserSelect","removeChild","documentId","pageNumber","JSON","parse","clickNode","fireEvent","addEventListener","removeEventListener","e","clientX","clientY","findAnnotationAtPoint","StoreAdapter","definition","annotationId","annotation","content","commentId","__getAnnotations","fn","then","annotations","a","__addAnnotation","__editAnnotation","__deleteAnnotation","success","__addComment","comment","__deleteComment","REGEXP","replacement","Math","random","toString","uuid","LocalStoreAdapter","getAnnotations","filter","page","getAnnotation","findAnnotation","addAnnotation","updateAnnotations","editAnnotation","deleteAnnotation","getComments","addComment","class","deleteComment","localStorage","getItem","setItem","stringify","UPPER_REGEX","BLACKLIST","setAttributes","node","attributes","indexOf","keyCase","REGEX_HASHLESS_HEX","normalizeColor","color","test","createRect","createElementNS","isFirefox","navigator","userAgent","child","group","fill","fillOpacity","rectangles","stroke","renderRect","strokeWidth","line","x1","y1","x2","y2","outerSVG","path","renderPoint","size","fontSize","innerHTML","renderText","lines","p1","p2","renderPath","id","transform","trans","rotation","getTranslation","querySelector","objectAssign","createScreenReaderOnly","overflow","insertElementWithinElement","insertBefore","textLayerElementFromPoint","max","temp","cloneNode","tail","outerHTML","insertElementWithinChildren","nodes","textLayer","insertScreenReaderComment","item","renderScreenReaderComments","comments","isArray","PDFJSAnnotate","getStoreAdapter","getElementById","COMMENT_TYPES","reorderAnnotationsByType","removeAnnotation","renderScreenReaderHints","removeElementById","insertComment","removeComment","elementId","SORT_TYPES","sortBy","sort","num","rects","first","last","insertScreenReaderHint","sortByPoint","b","sortByRectPoint","lineA","lineB","overlay","dragOffsetX","dragOffsetY","dragStartX","dragStartY","_enabled","isDragging","createEditOverlay","destroyEditOverlay","anchor","findSVGContainer","styleLeft","styleTop","boxSizing","border","borderRadius","background","padding","textAlign","textDecoration","handleDocumentClick","handleDocumentKeyup","handleDocumentMousedown","borderColor","boxShadow","display","handleDocumentMousemove","handleDocumentMouseup","keyCode","cursor","offsetHeight","offsetWidth","calcDelta","deltaX","deltaY","propX","propY","modelY","viewY","modelX","viewX","originX","originY","setTimeout","handleAnnotationClick","_penSize","_penColor","point","savePoint","_pointColor","setEdit","_type","_highlightColor","_strikeoutColor","_areaColor","getSelection","getRangeAt","getClientRects","getSelectionRects","saveRect","removeAllRanges","boundingRect","offset","input","_textSize","_textColor","handleInputBlur","handleInputKeyup","focus","saveText","closeInput","trim","approximateFraction","floor","xinv","x_","q","roundToDivide","div","round","disableEdit","enableEdit","disablePen","enablePen","setPen","penSize","penColor","disablePoint","enablePoint","setPoint","pointColor","disableRect","enableRect","setHighlight","highlightColor","setStrikeout","strikeoutColor","setArea","areaColor","disableText","enableText","setText","textSize","textColor","createPage","children","canvas","mozOpaque","renderPage","renderOptions","pdfDocument","rotate","all","getPage","pdfPage","canvasContext","getContext","alpha","getViewport","wrapper","outputScale","ctx","devicePixelRatio","backingStoreRatio","webkitBackingStorePixelRatio","mozBackingStorePixelRatio","msBackingStorePixelRatio","oBackingStorePixelRatio","backingStorePixelRatio","pixelRatio","sx","sy","scaled","sfx","sfy","visibility","scalePage","render","getTextContent","normalizeWhitespace","textContent","textLayerBuilder","pdfjsViewer","DefaultTextLayerFactory","createTextLayerBuilder","setTextContent","__storeAdapter","setStoreAdapter","adapter","UI","data","removeAttribute"],"mappings":"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","file":"pdf-annotate.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"PDFAnnotate\"] = factory();\n\telse\n\t\troot[\"PDFAnnotate\"] = factory();\n})(window, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 3);\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\nvar R = typeof Reflect === 'object' ? Reflect : null\nvar ReflectApply = R && typeof R.apply === 'function'\n  ? R.apply\n  : function ReflectApply(target, receiver, args) {\n    return Function.prototype.apply.call(target, receiver, args);\n  }\n\nvar ReflectOwnKeys\nif (R && typeof R.ownKeys === 'function') {\n  ReflectOwnKeys = R.ownKeys\n} else if (Object.getOwnPropertySymbols) {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target)\n      .concat(Object.getOwnPropertySymbols(target));\n  };\n} else {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target);\n  };\n}\n\nfunction ProcessEmitWarning(warning) {\n  if (console && console.warn) console.warn(warning);\n}\n\nvar NumberIsNaN = Number.isNaN || function NumberIsNaN(value) {\n  return value !== value;\n}\n\nfunction EventEmitter() {\n  EventEmitter.init.call(this);\n}\nmodule.exports = EventEmitter;\nmodule.exports.once = once;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._eventsCount = 0;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nvar defaultMaxListeners = 10;\n\nfunction checkListener(listener) {\n  if (typeof listener !== 'function') {\n    throw new TypeError('The \"listener\" argument must be of type Function. Received type ' + typeof listener);\n  }\n}\n\nObject.defineProperty(EventEmitter, 'defaultMaxListeners', {\n  enumerable: true,\n  get: function() {\n    return defaultMaxListeners;\n  },\n  set: function(arg) {\n    if (typeof arg !== 'number' || arg < 0 || NumberIsNaN(arg)) {\n      throw new RangeError('The value of \"defaultMaxListeners\" is out of range. It must be a non-negative number. Received ' + arg + '.');\n    }\n    defaultMaxListeners = arg;\n  }\n});\n\nEventEmitter.init = function() {\n\n  if (this._events === undefined ||\n      this._events === Object.getPrototypeOf(this)._events) {\n    this._events = Object.create(null);\n    this._eventsCount = 0;\n  }\n\n  this._maxListeners = this._maxListeners || undefined;\n};\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function setMaxListeners(n) {\n  if (typeof n !== 'number' || n < 0 || NumberIsNaN(n)) {\n    throw new RangeError('The value of \"n\" is out of range. It must be a non-negative number. Received ' + n + '.');\n  }\n  this._maxListeners = n;\n  return this;\n};\n\nfunction _getMaxListeners(that) {\n  if (that._maxListeners === undefined)\n    return EventEmitter.defaultMaxListeners;\n  return that._maxListeners;\n}\n\nEventEmitter.prototype.getMaxListeners = function getMaxListeners() {\n  return _getMaxListeners(this);\n};\n\nEventEmitter.prototype.emit = function emit(type) {\n  var args = [];\n  for (var i = 1; i < arguments.length; i++) args.push(arguments[i]);\n  var doError = (type === 'error');\n\n  var events = this._events;\n  if (events !== undefined)\n    doError = (doError && events.error === undefined);\n  else if (!doError)\n    return false;\n\n  // If there is no 'error' event listener then throw.\n  if (doError) {\n    var er;\n    if (args.length > 0)\n      er = args[0];\n    if (er instanceof Error) {\n      // Note: The comments on the `throw` lines are intentional, they show\n      // up in Node's output if this results in an unhandled exception.\n      throw er; // Unhandled 'error' event\n    }\n    // At least give some kind of context to the user\n    var err = new Error('Unhandled error.' + (er ? ' (' + er.message + ')' : ''));\n    err.context = er;\n    throw err; // Unhandled 'error' event\n  }\n\n  var handler = events[type];\n\n  if (handler === undefined)\n    return false;\n\n  if (typeof handler === 'function') {\n    ReflectApply(handler, this, args);\n  } else {\n    var len = handler.length;\n    var listeners = arrayClone(handler, len);\n    for (var i = 0; i < len; ++i)\n      ReflectApply(listeners[i], this, args);\n  }\n\n  return true;\n};\n\nfunction _addListener(target, type, listener, prepend) {\n  var m;\n  var events;\n  var existing;\n\n  checkListener(listener);\n\n  events = target._events;\n  if (events === undefined) {\n    events = target._events = Object.create(null);\n    target._eventsCount = 0;\n  } else {\n    // To avoid recursion in the case that type === \"newListener\"! Before\n    // adding it to the listeners, first emit \"newListener\".\n    if (events.newListener !== undefined) {\n      target.emit('newListener', type,\n                  listener.listener ? listener.listener : listener);\n\n      // Re-assign `events` because a newListener handler could have caused the\n      // this._events to be assigned to a new object\n      events = target._events;\n    }\n    existing = events[type];\n  }\n\n  if (existing === undefined) {\n    // Optimize the case of one listener. Don't need the extra array object.\n    existing = events[type] = listener;\n    ++target._eventsCount;\n  } else {\n    if (typeof existing === 'function') {\n      // Adding the second element, need to change to array.\n      existing = events[type] =\n        prepend ? [listener, existing] : [existing, listener];\n      // If we've already got an array, just append.\n    } else if (prepend) {\n      existing.unshift(listener);\n    } else {\n      existing.push(listener);\n    }\n\n    // Check for listener leak\n    m = _getMaxListeners(target);\n    if (m > 0 && existing.length > m && !existing.warned) {\n      existing.warned = true;\n      // No error code for this since it is a Warning\n      // eslint-disable-next-line no-restricted-syntax\n      var w = new Error('Possible EventEmitter memory leak detected. ' +\n                          existing.length + ' ' + String(type) + ' listeners ' +\n                          'added. Use emitter.setMaxListeners() to ' +\n                          'increase limit');\n      w.name = 'MaxListenersExceededWarning';\n      w.emitter = target;\n      w.type = type;\n      w.count = existing.length;\n      ProcessEmitWarning(w);\n    }\n  }\n\n  return target;\n}\n\nEventEmitter.prototype.addListener = function addListener(type, listener) {\n  return _addListener(this, type, listener, false);\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.prependListener =\n    function prependListener(type, listener) {\n      return _addListener(this, type, listener, true);\n    };\n\nfunction onceWrapper() {\n  if (!this.fired) {\n    this.target.removeListener(this.type, this.wrapFn);\n    this.fired = true;\n    if (arguments.length === 0)\n      return this.listener.call(this.target);\n    return this.listener.apply(this.target, arguments);\n  }\n}\n\nfunction _onceWrap(target, type, listener) {\n  var state = { fired: false, wrapFn: undefined, target: target, type: type, listener: listener };\n  var wrapped = onceWrapper.bind(state);\n  wrapped.listener = listener;\n  state.wrapFn = wrapped;\n  return wrapped;\n}\n\nEventEmitter.prototype.once = function once(type, listener) {\n  checkListener(listener);\n  this.on(type, _onceWrap(this, type, listener));\n  return this;\n};\n\nEventEmitter.prototype.prependOnceListener =\n    function prependOnceListener(type, listener) {\n      checkListener(listener);\n      this.prependListener(type, _onceWrap(this, type, listener));\n      return this;\n    };\n\n// Emits a 'removeListener' event if and only if the listener was removed.\nEventEmitter.prototype.removeListener =\n    function removeListener(type, listener) {\n      var list, events, position, i, originalListener;\n\n      checkListener(listener);\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      list = events[type];\n      if (list === undefined)\n        return this;\n\n      if (list === listener || list.listener === listener) {\n        if (--this._eventsCount === 0)\n          this._events = Object.create(null);\n        else {\n          delete events[type];\n          if (events.removeListener)\n            this.emit('removeListener', type, list.listener || listener);\n        }\n      } else if (typeof list !== 'function') {\n        position = -1;\n\n        for (i = list.length - 1; i >= 0; i--) {\n          if (list[i] === listener || list[i].listener === listener) {\n            originalListener = list[i].listener;\n            position = i;\n            break;\n          }\n        }\n\n        if (position < 0)\n          return this;\n\n        if (position === 0)\n          list.shift();\n        else {\n          spliceOne(list, position);\n        }\n\n        if (list.length === 1)\n          events[type] = list[0];\n\n        if (events.removeListener !== undefined)\n          this.emit('removeListener', type, originalListener || listener);\n      }\n\n      return this;\n    };\n\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\n\nEventEmitter.prototype.removeAllListeners =\n    function removeAllListeners(type) {\n      var listeners, events, i;\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      // not listening for removeListener, no need to emit\n      if (events.removeListener === undefined) {\n        if (arguments.length === 0) {\n          this._events = Object.create(null);\n          this._eventsCount = 0;\n        } else if (events[type] !== undefined) {\n          if (--this._eventsCount === 0)\n            this._events = Object.create(null);\n          else\n            delete events[type];\n        }\n        return this;\n      }\n\n      // emit removeListener for all listeners on all events\n      if (arguments.length === 0) {\n        var keys = Object.keys(events);\n        var key;\n        for (i = 0; i < keys.length; ++i) {\n          key = keys[i];\n          if (key === 'removeListener') continue;\n          this.removeAllListeners(key);\n        }\n        this.removeAllListeners('removeListener');\n        this._events = Object.create(null);\n        this._eventsCount = 0;\n        return this;\n      }\n\n      listeners = events[type];\n\n      if (typeof listeners === 'function') {\n        this.removeListener(type, listeners);\n      } else if (listeners !== undefined) {\n        // LIFO order\n        for (i = listeners.length - 1; i >= 0; i--) {\n          this.removeListener(type, listeners[i]);\n        }\n      }\n\n      return this;\n    };\n\nfunction _listeners(target, type, unwrap) {\n  var events = target._events;\n\n  if (events === undefined)\n    return [];\n\n  var evlistener = events[type];\n  if (evlistener === undefined)\n    return [];\n\n  if (typeof evlistener === 'function')\n    return unwrap ? [evlistener.listener || evlistener] : [evlistener];\n\n  return unwrap ?\n    unwrapListeners(evlistener) : arrayClone(evlistener, evlistener.length);\n}\n\nEventEmitter.prototype.listeners = function listeners(type) {\n  return _listeners(this, type, true);\n};\n\nEventEmitter.prototype.rawListeners = function rawListeners(type) {\n  return _listeners(this, type, false);\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  if (typeof emitter.listenerCount === 'function') {\n    return emitter.listenerCount(type);\n  } else {\n    return listenerCount.call(emitter, type);\n  }\n};\n\nEventEmitter.prototype.listenerCount = listenerCount;\nfunction listenerCount(type) {\n  var events = this._events;\n\n  if (events !== undefined) {\n    var evlistener = events[type];\n\n    if (typeof evlistener === 'function') {\n      return 1;\n    } else if (evlistener !== undefined) {\n      return evlistener.length;\n    }\n  }\n\n  return 0;\n}\n\nEventEmitter.prototype.eventNames = function eventNames() {\n  return this._eventsCount > 0 ? ReflectOwnKeys(this._events) : [];\n};\n\nfunction arrayClone(arr, n) {\n  var copy = new Array(n);\n  for (var i = 0; i < n; ++i)\n    copy[i] = arr[i];\n  return copy;\n}\n\nfunction spliceOne(list, index) {\n  for (; index + 1 < list.length; index++)\n    list[index] = list[index + 1];\n  list.pop();\n}\n\nfunction unwrapListeners(arr) {\n  var ret = new Array(arr.length);\n  for (var i = 0; i < ret.length; ++i) {\n    ret[i] = arr[i].listener || arr[i];\n  }\n  return ret;\n}\n\nfunction once(emitter, name) {\n  return new Promise(function (resolve, reject) {\n    function eventListener() {\n      if (errorListener !== undefined) {\n        emitter.removeListener('error', errorListener);\n      }\n      resolve([].slice.call(arguments));\n    };\n    var errorListener;\n\n    // Adding an error listener is not optional because\n    // if an error is thrown on an event emitter we cannot\n    // guarantee that the actual event we are waiting will\n    // be fired. The result could be a silent way to create\n    // memory or file descriptor leaks, which is something\n    // we should avoid.\n    if (name !== 'error') {\n      errorListener = function errorListener(err) {\n        emitter.removeListener(name, eventListener);\n        reject(err);\n      };\n\n      emitter.once('error', errorListener);\n    }\n\n    emitter.once(name, eventListener);\n  });\n}\n","module.exports = function createStyleSheet(blocks) {\n  var style = document.createElement('style');\n  var text = Object.keys(blocks).map(function (selector) {\n    return processRuleSet(selector, blocks[selector]);\n  }).join('\\n');\n  \n  style.setAttribute('type', 'text/css');\n  style.appendChild(document.createTextNode(text));\n\n  return style;\n}\n\nfunction processRuleSet(selector, block) {\n  return selector + ' {\\n' + processDeclarationBlock(block) + '\\n}';\n}\n\nfunction processDeclarationBlock(block) {\n  return Object.keys(block).map(function (prop) {\n    return processDeclaration(prop, block[prop]);\n  }).join('\\n');\n}\n\nfunction processDeclaration(prop, value) {\n  if (!isNaN(value) && value != 0) {\n    value = value + 'px';\n  }\n\n  return hyphenate(prop) + ': ' + value + ';';\n}\n\nfunction hyphenate(prop) {\n  return prop.replace(/[A-Z]/g, function (match) {\n    return '-' + match.toLowerCase();\n  });\n}\n","/*\nobject-assign\n(c) Sindre Sorhus\n@license MIT\n*/\n\n'use strict';\n/* eslint-disable no-unused-vars */\nvar getOwnPropertySymbols = Object.getOwnPropertySymbols;\nvar hasOwnProperty = Object.prototype.hasOwnProperty;\nvar propIsEnumerable = Object.prototype.propertyIsEnumerable;\n\nfunction toObject(val) {\n\tif (val === null || val === undefined) {\n\t\tthrow new TypeError('Object.assign cannot be called with null or undefined');\n\t}\n\n\treturn Object(val);\n}\n\nfunction shouldUseNative() {\n\ttry {\n\t\tif (!Object.assign) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Detect buggy property enumeration order in older V8 versions.\n\n\t\t// https://bugs.chromium.org/p/v8/issues/detail?id=4118\n\t\tvar test1 = new String('abc');  // eslint-disable-line no-new-wrappers\n\t\ttest1[5] = 'de';\n\t\tif (Object.getOwnPropertyNames(test1)[0] === '5') {\n\t\t\treturn false;\n\t\t}\n\n\t\t// https://bugs.chromium.org/p/v8/issues/detail?id=3056\n\t\tvar test2 = {};\n\t\tfor (var i = 0; i < 10; i++) {\n\t\t\ttest2['_' + String.fromCharCode(i)] = i;\n\t\t}\n\t\tvar order2 = Object.getOwnPropertyNames(test2).map(function (n) {\n\t\t\treturn test2[n];\n\t\t});\n\t\tif (order2.join('') !== '0123456789') {\n\t\t\treturn false;\n\t\t}\n\n\t\t// https://bugs.chromium.org/p/v8/issues/detail?id=3056\n\t\tvar test3 = {};\n\t\t'abcdefghijklmnopqrst'.split('').forEach(function (letter) {\n\t\t\ttest3[letter] = letter;\n\t\t});\n\t\tif (Object.keys(Object.assign({}, test3)).join('') !==\n\t\t\t\t'abcdefghijklmnopqrst') {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t} catch (err) {\n\t\t// We don't expect any of the above to throw, but better to be safe.\n\t\treturn false;\n\t}\n}\n\nmodule.exports = shouldUseNative() ? Object.assign : function (target, source) {\n\tvar from;\n\tvar to = toObject(target);\n\tvar symbols;\n\n\tfor (var s = 1; s < arguments.length; s++) {\n\t\tfrom = Object(arguments[s]);\n\n\t\tfor (var key in from) {\n\t\t\tif (hasOwnProperty.call(from, key)) {\n\t\t\t\tto[key] = from[key];\n\t\t\t}\n\t\t}\n\n\t\tif (getOwnPropertySymbols) {\n\t\t\tsymbols = getOwnPropertySymbols(from);\n\t\t\tfor (var i = 0; i < symbols.length; i++) {\n\t\t\t\tif (propIsEnumerable.call(from, symbols[i])) {\n\t\t\t\t\tto[symbols[i]] = from[symbols[i]];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn to;\n};\n","/**\n * Throw an Error for an abstract function that hasn't been implemented.\n *\n * @param {String} name The name of the abstract function\n */\nexport default function abstractFunction(name) {\n  throw new Error(name + ' is not implemented');\n}\n","import createStyleSheet from 'create-stylesheet';\n\nexport const BORDER_COLOR = '#00BFFF';\n\nconst userSelectStyleSheet = createStyleSheet({\n  body: {\n    '-webkit-user-select': 'none',\n       '-moz-user-select': 'none',\n        '-ms-user-select': 'none',\n            'user-select': 'none'\n  }\n});\nuserSelectStyleSheet.setAttribute('data-pdf-annotate-user-select', 'true');\n\n/**\n * Find the SVGElement that contains all the annotations for a page\n *\n * @param {Element} node An annotation within that container\n * @return {SVGElement} The container SVG or null if it can't be found\n */\nexport function findSVGContainer(node) {\n  let parentNode = node;\n\n  while ((parentNode = parentNode.parentNode) &&\n          parentNode !== document) {\n    if (parentNode.nodeName.toUpperCase() === 'SVG' &&\n        parentNode.getAttribute('data-pdf-annotate-container') === 'true') {\n      return parentNode;\n    }\n  }\n\n  return null;\n}\n\n/**\n * Find an SVGElement container at a given point\n *\n * @param {Number} x The x coordinate of the point\n * @param {Number} y The y coordinate of the point\n * @return {SVGElement} The container SVG or null if one can't be found\n */\nexport function findSVGAtPoint(x, y) {\n  let elements = document.querySelectorAll('svg[data-pdf-annotate-container=\"true\"]');\n\n  for (let i=0, l=elements.length; i<l; i++) {\n    let el = elements[i];\n    let rect = el.getBoundingClientRect();\n\n    if (pointIntersectsRect(x, y, rect)) {\n\n      return el;\n    }\n  }\n\n  return null;\n}\n\n/**\n * Find an Element that represents an annotation at a given point\n *\n * @param {Number} x The x coordinate of the point\n * @param {Number} y The y coordinate of the point\n * @return {Element} The annotation element or null if one can't be found\n */\nexport function findAnnotationAtPoint(x, y) {\n  let svg = findSVGAtPoint(x, y);\n  if (!svg) { return; }\n  let elements = svg.querySelectorAll('[data-pdf-annotate-type]');\n\n  // Find a target element within SVG\n  for (let i=0, l=elements.length; i<l; i++) {\n    let el = elements[i];\n    if (pointIntersectsRect(x, y, getOffsetAnnotationRect(el))) {\n      return el;\n    }\n  }\n\n  return null;\n}\n\n/**\n * Determine if a point intersects a rect\n *\n * @param {Number} x The x coordinate of the point\n * @param {Number} y The y coordinate of the point\n * @param {Object} rect The points of a rect (likely from getBoundingClientRect)\n * @return {Boolean} True if a collision occurs, otherwise false\n */\nexport function pointIntersectsRect(x, y, rect) {\n  return y >= rect.top && y <= rect.bottom && x >= rect.left && x <= rect.right;\n}\n\n/**\n * Get the rect of an annotation element accounting for offset.\n *\n * @param {Element} el The element to get the rect of\n * @return {Object} The dimensions of the element\n */\nexport function getOffsetAnnotationRect(el) {\n  let rect = getAnnotationRect(el);\n  let { offsetLeft, offsetTop } = getOffset(el);\n  return {\n    top: rect.top + offsetTop,\n    left: rect.left + offsetLeft,\n    right: rect.right + offsetLeft,\n    bottom: rect.bottom + offsetTop\n  };\n}\n\n/**\n * Get the rect of an annotation element.\n *\n * @param {Element} el The element to get the rect of\n * @return {Object} The dimensions of the element\n */\nexport function getAnnotationRect(el) {\n  let h = 0, w = 0, x = 0, y = 0;\n  let rect = el.getBoundingClientRect();\n  // TODO this should be calculated somehow\n  const LINE_OFFSET = 16;\n\n  switch (el.nodeName.toLowerCase()) {\n    case 'path':\n    let minX, maxX, minY, maxY;\n\n    el.getAttribute('d').replace(/Z/, '').split('M').splice(1).forEach((p) => {\n      var s = p.split(' ').map(i => parseInt(i, 10));\n\n      if (typeof minX === 'undefined' || s[0] < minX) { minX = s[0]; }\n      if (typeof maxX === 'undefined' || s[2] > maxX) { maxX = s[2]; }\n      if (typeof minY === 'undefined' || s[1] < minY) { minY = s[1]; }\n      if (typeof maxY === 'undefined' || s[3] > maxY) { maxY = s[3]; }\n    });\n\n    h = maxY - minY;\n    w = maxX - minX;\n    x = minX;\n    y = minY;\n    break;\n\n    case 'line':\n    h = parseInt(el.getAttribute('y2'), 10) - parseInt(el.getAttribute('y1'), 10);\n    w = parseInt(el.getAttribute('x2'), 10) - parseInt(el.getAttribute('x1'), 10);\n    x = parseInt(el.getAttribute('x1'), 10);\n    y = parseInt(el.getAttribute('y1'), 10);\n\n    if (h === 0) {\n      h += LINE_OFFSET;\n      y -= (LINE_OFFSET / 2);\n    }\n    break;\n\n    case 'text':\n    h = rect.height;\n    w = rect.width;\n    x = parseInt(el.getAttribute('x'), 10);\n    y = parseInt(el.getAttribute('y'), 10) - h;\n    break;\n\n    case 'g':\n    let { offsetLeft, offsetTop } = getOffset(el);\n    h = rect.height;\n    w = rect.width;\n    x = rect.left - offsetLeft;\n    y = rect.top - offsetTop;\n\n    if (el.getAttribute('data-pdf-annotate-type') === 'strikeout') {\n      h += LINE_OFFSET;\n      y -= (LINE_OFFSET / 2);\n    }\n    break;\n\n    case 'rect':\n    case 'svg':\n    h = parseInt(el.getAttribute('height'), 10);\n    w = parseInt(el.getAttribute('width'), 10);\n    x = parseInt(el.getAttribute('x'), 10);\n    y = parseInt(el.getAttribute('y'), 10);\n    break;\n  }\n\n  // Result provides same properties as getBoundingClientRect\n  let result = {\n    top: y,\n    left: x,\n    width: w,\n    height: h,\n    right: x + w,\n    bottom: y + h\n  };\n\n  // For the case of nested SVG (point annotations) and grouped\n  // lines or rects no adjustment needs to be made for scale.\n  // I assume that the scale is already being handled\n  // natively by virtue of the `transform` attribute.\n  if (!['svg', 'g'].includes(el.nodeName.toLowerCase())) {\n    result = scaleUp(findSVGAtPoint(rect.left, rect.top), result);\n  }\n\n  return result;\n}\n\n/**\n * Adjust scale from normalized scale (100%) to rendered scale.\n *\n * @param {SVGElement} svg The SVG to gather metadata from\n * @param {Object} rect A map of numeric values to scale\n * @return {Object} A copy of `rect` with values scaled up\n */\nexport function scaleUp(svg, rect) {\n  let result = {};\n  let { viewport } = getMetadata(svg);\n\n  Object.keys(rect).forEach((key) => {\n    result[key] = rect[key] * viewport.scale;\n  });\n\n  return result;\n}\n\n/**\n * Adjust scale from rendered scale to a normalized scale (100%).\n *\n * @param {SVGElement} svg The SVG to gather metadata from\n * @param {Object} rect A map of numeric values to scale\n * @return {Object} A copy of `rect` with values scaled down\n */\nexport function scaleDown(svg, rect) {\n  let result = {};\n  let { viewport } = getMetadata(svg);\n\n  Object.keys(rect).forEach((key) => {\n    result[key] = rect[key] / viewport.scale;\n  });\n\n  return result;\n}\n\n/**\n * Get the scroll position of an element, accounting for parent elements\n *\n * @param {Element} el The element to get the scroll position for\n * @return {Object} The scrollTop and scrollLeft position\n */\nexport function getScroll(el) {\n  let scrollTop = 0;\n  let scrollLeft = 0;\n  let parentNode = el;\n\n  while ((parentNode = parentNode.parentNode) &&\n          parentNode !== document) {\n    scrollTop += parentNode.scrollTop;\n    scrollLeft += parentNode.scrollLeft;\n  }\n\n  return { scrollTop, scrollLeft };\n}\n\n/**\n * Get the offset position of an element, accounting for parent elements\n *\n * @param {Element} el The element to get the offset position for\n * @return {Object} The offsetTop and offsetLeft position\n */\nexport function getOffset(el) {\n  let parentNode = el;\n\n  while ((parentNode = parentNode.parentNode) &&\n          parentNode !== document) {\n    if (parentNode.nodeName.toUpperCase() === 'SVG') {\n      break;\n    }\n  }\n\n  let rect = parentNode.getBoundingClientRect();\n\n  return { offsetLeft: rect.left, offsetTop: rect.top };\n}\n\n/**\n * Disable user ability to select text on page\n */\nexport function disableUserSelect() {\n  if (!userSelectStyleSheet.parentNode) {\n    document.head.appendChild(userSelectStyleSheet);\n  }\n}\n\n\n/**\n * Enable user ability to select text on page\n */\nexport function enableUserSelect() {\n  if (userSelectStyleSheet.parentNode) {\n    userSelectStyleSheet.parentNode.removeChild(userSelectStyleSheet);\n  }\n}\n\n/**\n * Get the metadata for a SVG container\n *\n * @param {SVGElement} svg The SVG container to get metadata for\n */\nexport function getMetadata(svg) {\n  return {\n    documentId: svg.getAttribute('data-pdf-annotate-document'),\n    pageNumber: parseInt(svg.getAttribute('data-pdf-annotate-page'), 10),\n    viewport: JSON.parse(svg.getAttribute('data-pdf-annotate-viewport'))\n  };\n}\n","import EventEmitter from 'events';\nimport {\n  findAnnotationAtPoint,\n  findSVGAtPoint\n} from './utils';\n\nconst emitter = new EventEmitter;\n\nlet clickNode;\n\n/**\n * Handle document.click event\n *\n * @param {Event} e The DOM event to be handled\n */\ndocument.addEventListener('click', function handleDocumentClick(e) {\n  if (!findSVGAtPoint(e.clientX, e.clientY)) { return; }\n\n  let target = findAnnotationAtPoint(e.clientX, e.clientY);\n\n  // Emit annotation:blur if clickNode is no longer clicked\n  if (clickNode && clickNode !== target) {\n    emitter.emit('annotation:blur', clickNode);\n  }\n\n  // Emit annotation:click if target was clicked\n  if (target) {\n    emitter.emit('annotation:click', target);\n  }\n\n  clickNode = target;\n});\n\n// let mouseOverNode;\n// document.addEventListener('mousemove', function handleDocumentMousemove(e) {\n//   let target = findAnnotationAtPoint(e.clientX, e.clientY);\n//\n//   // Emit annotation:mouseout if target was mouseout'd\n//   if (mouseOverNode && !target) {\n//     emitter.emit('annotation:mouseout', mouseOverNode);\n//   }\n//\n//   // Emit annotation:mouseover if target was mouseover'd\n//   if (target && mouseOverNode !== target) {\n//     emitter.emit('annotation:mouseover', target);\n//   }\n//\n//   mouseOverNode = target;\n// });\n\nexport function fireEvent() { emitter.emit(...arguments); };\nexport function addEventListener() { emitter.on(...arguments); };\nexport function removeEventListener() { emitter.removeListener(...arguments); };\n","import abstractFunction from '../utils/abstractFunction';\nimport { fireEvent } from '../UI/event';\n\n// Adapter should never be invoked publicly\nexport default class StoreAdapter {\n  /**\n   * Create a new StoreAdapter instance\n   *\n   * @param {Object} [definition] The definition to use for overriding abstract methods\n   */\n  constructor(definition = {}) {\n    // Copy each function from definition if it is a function we know about\n    Object.keys(definition).forEach((key) => {\n      if (typeof definition[key] === 'function' &&\n          typeof this[key] === 'function') {\n        this[key] = definition[key];\n      }\n    });\n  }\n\n  /**\n   * Get all the annotations for a given document and page number.\n   *\n   * @param {String} documentId The ID for the document the annotations belong to\n   * @param {Number} pageNumber The number of the page the annotations belong to\n   * @return {Promise}\n   */\n  __getAnnotations(documentId, pageNumber) { abstractFunction('getAnnotations'); }\n  get getAnnotations() { return this.__getAnnotations; }\n  set getAnnotations(fn) {\n    this.__getAnnotations = function getAnnotations(documentId, pageNumber) {\n      return fn(...arguments).then((annotations) => {\n        // TODO may be best to have this happen on the server\n        if (annotations.annotations) {\n          annotations.annotations.forEach((a) => {\n            a.documentId = documentId;\n          });\n        }\n        return annotations;\n      });\n    };\n  }\n\n  /**\n   * Get the definition for a specific annotation.\n   *\n   * @param {String} documentId The ID for the document the annotation belongs to\n   * @param {String} annotationId The ID for the annotation\n   * @return {Promise}\n   */\n  getAnnotation(documentId, annotationId) { abstractFunction('getAnnotation'); }\n\n  /**\n   * Add an annotation\n   *\n   * @param {String} documentId The ID for the document to add the annotation to\n   * @param {String} pageNumber The page number to add the annotation to\n   * @param {Object} annotation The definition for the new annotation\n   * @return {Promise}\n   */\n  __addAnnotation(documentId, pageNumber, annotation) { abstractFunction('addAnnotation'); }\n  get addAnnotation() { return this.__addAnnotation; }\n  set addAnnotation(fn) {\n    this.__addAnnotation = function addAnnotation(documentId, pageNumber, annotation) {\n      return fn(...arguments).then((annotation) => {\n        fireEvent('annotation:add', documentId, pageNumber, annotation);\n        return annotation;\n      });\n    };\n  }\n\n  /**\n   * Edit an annotation\n   *\n   * @param {String} documentId The ID for the document\n   * @param {String} pageNumber the page number of the annotation\n   * @param {Object} annotation The definition of the modified annotation\n   * @return {Promise}\n   */\n  __editAnnotation(documentId, pageNumber, annotation) { abstractFunction('editAnnotation'); }\n  get editAnnotation() { return this.__editAnnotation; }\n  set editAnnotation(fn) {\n    this.__editAnnotation = function editAnnotation(documentId, annotationId, annotation) {\n      return fn(...arguments).then((annotation) => {\n        fireEvent('annotation:edit', documentId, annotationId, annotation);\n        return annotation;\n      });\n    };\n  }\n\n  /**\n   * Delete an annotation\n   *\n   * @param {String} documentId The ID for the document\n   * @param {String} annotationId The ID for the annotation\n   * @return {Promise}\n   */\n  __deleteAnnotation(documentId, annotationId) { abstractFunction('deleteAnnotation'); }\n  get deleteAnnotation() { return this.__deleteAnnotation; }\n  set deleteAnnotation(fn) {\n    this.__deleteAnnotation = function deleteAnnotation(documentId, annotationId) {\n      return fn(...arguments).then((success) => {\n        if (success) {\n          fireEvent('annotation:delete', documentId, annotationId);\n        }\n        return success;\n      });\n    };\n  }\n\n  /**\n   * Get all the comments for an annotation\n   *\n   * @param {String} documentId The ID for the document\n   * @param {String} annotationId The ID for the annotation\n   * @return {Promise}\n   */\n  getComments(documentId, annotationId) { abstractFunction('getComments'); }\n\n  /**\n   * Add a new comment\n   *\n   * @param {String} documentId The ID for the document\n   * @param {String} annotationId The ID for the annotation\n   * @param {Object} content The definition of the comment\n   * @return {Promise}\n   */\n  __addComment(documentId, annotationId, content) { abstractFunction('addComment'); }\n  get addComment() { return this.__addComment; }\n  set addComment(fn) {\n    this.__addComment = function addComment(documentId, annotationId, content) {\n      return fn(...arguments).then((comment) => {\n        fireEvent('comment:add', documentId, annotationId, comment);\n        return comment;\n      });\n    };\n  }\n\n  /**\n   * Delete a comment\n   *\n   * @param {String} documentId The ID for the document\n   * @param {String} commentId The ID for the comment\n   * @return {Promise}\n   */\n  __deleteComment(documentId, commentId) { abstractFunction('deleteComment'); }\n  get deleteComment() { return this.__deleteComment; }\n  set deleteComment(fn) {\n    this.__deleteComment = function deleteComment(documentId, commentId) {\n      return fn(...arguments).then((success) => {\n        if (success) {\n          fireEvent('comment:delete', documentId, commentId);\n        }\n        return success;\n      });\n    };\n  }\n}\n","const REGEXP = /[xy]/g\nconst PATTERN = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx';\n\nfunction replacement(c) {\n  let r = Math.random()*16|0;\n  let v = c == 'x' ? r : (r&0x3|0x8);\n  return v.toString(16);\n}\n\n/**\n * Generate a univierally unique identifier\n *\n * @return {String}\n */\nexport default function uuid() {\n  return PATTERN.replace(REGEXP, replacement);\n}\n","import uuid from '../utils/uuid';\nimport StoreAdapter from './StoreAdapter';\n\n// StoreAdapter for working with localStorage\n// This is ideal for testing, examples, and prototyping\nexport default class LocalStoreAdapter extends StoreAdapter {\n  constructor() {\n    super({\n      getAnnotations(documentId, pageNumber) {\n        return new Promise((resolve, reject) => {\n          let annotations = getAnnotations(documentId).filter((i) => {\n            return i.page === pageNumber && i.class === 'Annotation';\n          });\n\n          resolve({\n            documentId,\n            pageNumber,\n            annotations\n          });\n        });\n      },\n\n      getAnnotation(documentId, annotationId) {\n        return Promise.resolve(getAnnotations(documentId)[findAnnotation(documentId, annotationId)]);\n      },\n\n      addAnnotation(documentId, pageNumber, annotation) {\n        return new Promise((resolve, reject) => {\n          annotation.class = 'Annotation';\n          annotation.uuid = uuid();\n          annotation.page = pageNumber;\n\n          let annotations = getAnnotations(documentId);\n          annotations.push(annotation);\n          updateAnnotations(documentId, annotations);\n\n          resolve(annotation);\n        });\n      },\n\n      editAnnotation(documentId, annotationId, annotation) {\n        return new Promise((resolve, reject) => {\n          let annotations = getAnnotations(documentId);\n          annotations[findAnnotation(documentId, annotationId)] = annotation;\n          updateAnnotations(documentId, annotations);\n\n          resolve(annotation);\n        });\n      },\n\n      deleteAnnotation(documentId, annotationId) {\n        return new Promise((resolve, reject) => {\n          let index = findAnnotation(documentId, annotationId);\n          if (index > -1) {\n            let annotations = getAnnotations(documentId);\n            annotations.splice(index, 1);\n            updateAnnotations(documentId, annotations);\n          }\n\n          resolve(true);\n        });\n      },\n\n      getComments(documentId, annotationId) {\n        return new Promise((resolve, reject) => {\n          resolve(getAnnotations(documentId).filter((i) => {\n            return i.class === 'Comment' && i.annotation === annotationId;\n          }));\n        });\n      },\n\n      addComment(documentId, annotationId, content) {\n        return new Promise((resolve, reject) => {\n          let comment = {\n            class: 'Comment',\n            uuid: uuid(),\n            annotation: annotationId,\n            content: content\n          };\n\n          let annotations = getAnnotations(documentId);\n          annotations.push(comment);\n          updateAnnotations(documentId, annotations);\n\n          resolve(comment);\n        });\n      },\n\n      deleteComment(documentId, commentId) {\n        return new Promise((resolve, reject) => {\n          getAnnotations(documentId);\n          let index = -1;\n          let annotations = getAnnotations(documentId);\n          for (let i=0, l=annotations.length; i<l; i++) {\n            if (annotations[i].uuid === commentId) {\n              index = i;\n              break;\n            }\n          }\n\n          if (index > -1) {\n            annotations.splice(index, 1);\n            updateAnnotations(documentId, annotations);\n          }\n\n          resolve(true);\n        });\n      }\n    });\n  }\n}\n\nfunction getAnnotations(documentId) {\n  return JSON.parse(localStorage.getItem(`${documentId}/annotations`)) || [];\n}\n\nfunction updateAnnotations(documentId, annotations) {\n  localStorage.setItem(`${documentId}/annotations`, JSON.stringify(annotations));\n}\n\nfunction findAnnotation(documentId, annotationId) {\n  let index = -1;\n  let annotations = getAnnotations(documentId);\n  for (let i=0, l=annotations.length; i<l; i++) {\n    if (annotations[i].uuid === annotationId) {\n      index = i;\n      break;\n    }\n  }\n  return index;\n}\n","const UPPER_REGEX = /[A-Z]/g;\n\n// Don't convert these attributes from camelCase to hyphenated-attributes\nconst BLACKLIST = [\n  'viewBox'\n];\n\nlet keyCase = (key) => {\n  if (BLACKLIST.indexOf(key) === -1) {\n    key = key.replace(UPPER_REGEX, match => '-' + match.toLowerCase());\n  }\n  return key;\n}\n\n/**\n * Set attributes for a node from a map\n *\n * @param {Node} node The node to set attributes on\n * @param {Object} attributes The map of key/value pairs to use for attributes\n */\nexport default function setAttributes(node, attributes) {\n  Object.keys(attributes).forEach((key) => {\n    node.setAttribute(keyCase(key), attributes[key]);\n  });\n}\n","const REGEX_HASHLESS_HEX = /^([a-f0-9]{6}|[a-f0-9]{3})$/i;\n\n/**\n * Normalize a color value\n *\n * @param {String} color The color to normalize\n * @return {String}\n */\nexport default function normalizeColor(color) {\n  if (REGEX_HASHLESS_HEX.test(color)) {\n    color = `#${color}`;\n  }\n  return color;\n}\n","import setAttributes from '../utils/setAttributes';\nimport normalizeColor from '../utils/normalizeColor';\n\n/**\n * Create SVGRectElements from an annotation definition.\n * This is used for anntations of type `area` and `highlight`.\n *\n * @param {Object} a The annotation definition\n * @return {SVGGElement|SVGRectElement} A group of all rects to be rendered\n */\nexport default function renderRect(a) {\n  if (a.type === 'highlight') {\n    let group = document.createElementNS('http://www.w3.org/2000/svg', 'g');\n    setAttributes(group, {\n      fill: normalizeColor(a.color || '#ff0'),\n      fillOpacity: 0.2\n    });\n    \n    a.rectangles.forEach((r) => {\n      group.appendChild(createRect(r));\n    });\n\n    return group;\n  } else {\n    let rect = createRect(a);\n    setAttributes(rect, {\n      stroke: normalizeColor(a.color || '#f00'),\n      fill: 'none'\n    });\n\n    return rect;\n  }\n}\n\nfunction createRect(r) {\n  let rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');\n\n  setAttributes(rect, {\n    x: r.x,\n    y: r.y,\n    width: r.width,\n    height: r.height\n  });\n\n  return rect;\n}\n","import objectAssign from 'object-assign';\nimport renderLine from './renderLine';\nimport renderPath from './renderPath';\nimport renderPoint from './renderPoint';\nimport renderRect from './renderRect';\nimport renderText from './renderText';\n\nconst isFirefox = /firefox/i.test(navigator.userAgent);\n\n/**\n * Get the x/y translation to be used for transforming the annotations\n * based on the rotation of the viewport.\n *\n * @param {Object} viewport The viewport data from the page\n * @return {Object}\n */\nfunction getTranslation(viewport) {\n  let x;\n  let y;\n\n  // Modulus 360 on the rotation so that we only\n  // have to worry about four possible values.\n  switch(viewport.rotation % 360) {\n    case 0:\n      x = y = 0;\n      break;\n    case 90:\n      x = 0;\n      y = (viewport.width / viewport.scale) * -1;\n      break;\n    case 180:\n      x = (viewport.width / viewport.scale) * -1;\n      y = (viewport.height / viewport.scale) * -1;\n      break;\n    case 270:\n      x = (viewport.height / viewport.scale) * -1;\n      y = 0;\n      break;\n  }\n\n  return { x, y };\n}\n\n/**\n * Transform the rotation and scale of a node using SVG's native transform attribute.\n *\n * @param {Node} node The node to be transformed\n * @param {Object} viewport The page's viewport data\n * @return {Node}\n */\nfunction transform(node, viewport) {\n  let trans = getTranslation(viewport);\n\n  // Let SVG natively transform the element\n  node.setAttribute('transform', `scale(${viewport.scale}) rotate(${viewport.rotation}) translate(${trans.x}, ${trans.y})`);\n  \n  // Manually adjust x/y for nested SVG nodes\n  if (!isFirefox && node.nodeName.toLowerCase() === 'svg') {\n    node.setAttribute('x', parseInt(node.getAttribute('x'), 10) * viewport.scale);\n    node.setAttribute('y', parseInt(node.getAttribute('y'), 10) * viewport.scale);\n\n    let x = parseInt(node.getAttribute('x', 10));\n    let y = parseInt(node.getAttribute('y', 10));\n    let width = parseInt(node.getAttribute('width'), 10);\n    let height = parseInt(node.getAttribute('height'), 10);\n    let path = node.querySelector('path');\n    let svg = path.parentNode;\n   \n    // Scale width/height\n    [node, svg, path, node.querySelector('rect')].forEach((n) => {\n      n.setAttribute('width', parseInt(n.getAttribute('width'), 10) * viewport.scale);\n      n.setAttribute('height', parseInt(n.getAttribute('height'), 10) * viewport.scale);\n    });\n\n    // Transform path but keep scale at 100% since it will be handled natively\n    transform(path, objectAssign({}, viewport, { scale: 1 }));\n    \n    switch(viewport.rotation % 360) {\n      case 90:\n        node.setAttribute('x', viewport.width - y - width);\n        node.setAttribute('y', x);\n        svg.setAttribute('x', 1);\n        svg.setAttribute('y', 0);\n        break;\n      case 180:\n        node.setAttribute('x', viewport.width - x - width);\n        node.setAttribute('y', viewport.height - y - height);\n        svg.setAttribute('y', 2);\n        break;\n      case 270:\n        node.setAttribute('x', y);\n        node.setAttribute('y', viewport.height - x - height);\n        svg.setAttribute('x', -1);\n        svg.setAttribute('y', 0);\n        break;\n    }\n  }\n\n  return node;\n}\n\n/**\n * Append an annotation as a child of an SVG.\n *\n * @param {SVGElement} svg The SVG element to append the annotation to\n * @param {Object} annotation The annotation definition to render and append\n * @param {Object} viewport The page's viewport data\n * @return {SVGElement} A node that was created and appended by this function\n */\nexport default function appendChild(svg, annotation, viewport) {\n  if (!viewport) {\n    viewport = JSON.parse(svg.getAttribute('data-pdf-annotate-viewport'));\n  }\n  \n  let child;\n  switch (annotation.type) {\n    case 'area':\n    case 'highlight':\n      child = renderRect(annotation);\n      break;\n    case 'strikeout':\n      child = renderLine(annotation);\n      break;\n    case 'point':\n      child = renderPoint(annotation);\n      break;\n    case 'textbox':\n      child = renderText(annotation);\n      break;\n    case 'drawing':\n      child = renderPath(annotation);\n      break;\n  }\n\n  // If no type was provided for an annotation it will result in node being null.\n  // Skip appending/transforming if node doesn't exist.\n  if (child) {\n    // Set attributes\n    child.setAttribute('data-pdf-annotate-id', annotation.id);\n    child.setAttribute('data-pdf-annotate-type', annotation.type);\n    child.setAttribute('aria-hidden', true);\n\n    svg.appendChild(transform(child, viewport));\n  }\n\n  return child;\n}\n","import setAttributes from '../utils/setAttributes';\nimport normalizeColor from '../utils/normalizeColor';\n\n/**\n * Create SVGLineElements from an annotation definition.\n * This is used for anntations of type `strikeout`.\n *\n * @param {Object} a The annotation definition\n * @return {SVGGElement} A group of all lines to be rendered\n */\nexport default function renderLine(a) {\n  let group = document.createElementNS('http://www.w3.org/2000/svg', 'g');\n  setAttributes(group, {\n    stroke: normalizeColor(a.color || '#f00'),\n    strokeWidth: 1\n  });\n\n  a.rectangles.forEach((r) => {\n    let line = document.createElementNS('http://www.w3.org/2000/svg', 'line');\n\n    setAttributes(line, {\n      x1: r.x,\n      y1: r.y,\n      x2: r.x + r.width,\n      y2: r.y,\n    });\n\n    group.appendChild(line);\n  });\n\n  return group;\n}\n","import setAttributes from '../utils/setAttributes';\n\nconst SIZE = 25;\nconst D = 'M16,9V4l1,0c0.55,0,1-0.45,1-1v0c0-0.55-0.45-1-1-1H7C6.45,2,6,2.45,6,3v0 c0,0.55,0.45,1,1,1l1,0v5c0,1.66-1.34,3-3,3h0v2h5.97v7l1,1l1-1v-7H19v-2h0C17.34,12,16,10.66,16,9z';\n\n/**\n * Create SVGElement from an annotation definition.\n * This is used for anntations of type `comment`.\n *\n * @param {Object} a The annotation definition\n * @return {SVGElement} A svg to be rendered\n */\nexport default function renderPoint(a) {\n  let outerSVG = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\n  let rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');\n  let path = document.createElementNS('http://www.w3.org/2000/svg', 'path');\n\n  setAttributes(outerSVG,  {\n    width: SIZE,\n    height: SIZE,\n    x: a.x,\n    y: a.y\n  });\n\n  setAttributes(rect, {\n    width: SIZE,\n    height: SIZE,\n    fillOpacity: 0,\n  });\n\n  setAttributes(path, {\n    d: D,\n    width: parseInt(outerSVG.getAttribute('width')),\n    height: parseInt(outerSVG.getAttribute('height')),\n    fill: `#${a.color}`\n  });\n\n  outerSVG.appendChild(rect);\n  outerSVG.appendChild(path);\n  return outerSVG;\n}\n","import setAttributes from '../utils/setAttributes';\nimport normalizeColor from '../utils/normalizeColor';\n\n/**\n * Create SVGTextElement from an annotation definition.\n * This is used for anntations of type `textbox`.\n *\n * @param {Object} a The annotation definition\n * @return {SVGTextElement} A text to be rendered\n */\nexport default function renderText(a) {\n  var text = document.createElementNS('http://www.w3.org/2000/svg', 'text');\n\n  setAttributes(text, {\n    x: a.x,\n    y: a.y + parseInt(a.size, 10),\n    fill: normalizeColor(a.color || '#000'),\n    fontSize: a.size\n  });\n  text.innerHTML = a.content;\n\n  return text;\n}\n","import setAttributes from '../utils/setAttributes';\nimport normalizeColor from '../utils/normalizeColor';\n\n/**\n * Create SVGPathElement from an annotation definition.\n * This is used for anntations of type `drawing`.\n *\n * @param {Object} a The annotation definition\n * @return {SVGPathElement} The path to be rendered\n */\nexport default function renderPath(a) {\n  let d = [];\n  let path = document.createElementNS('http://www.w3.org/2000/svg', 'path');\n  \n  for (let i=0, l=a.lines.length; i<l; i++) {\n    var p1 = a.lines[i];\n    var p2 = a.lines[i+1];\n    if (p2) {\n      d.push(`M${p1[0]} ${p1[1]} ${p2[0]} ${p2[1]}`);\n    }\n  }\n  \n  setAttributes(path, {\n    d: `${d.join(' ')}Z`,\n    stroke: normalizeColor(a.color || '#000'),\n    strokeWidth: a.width || 1,\n    fill: 'none'\n  });\n\n  return path;\n}\n","/**\n * Create a node that is only visible to screen readers\n *\n * @param {String} content The text content that should be read by screen reader\n * @param {String} [annotationId] The ID of the annotation assocaited\n * @return {Element} An Element that is only visible to screen readers\n */\nexport default function createScreenReaderOnly(content, annotationId) {\n  let node = document.createElement('div');\n  let text = document.createTextNode(content);\n  node.appendChild(text);\n  node.setAttribute('id', `pdf-annotate-screenreader-${annotationId}`);\n  node.style.position = 'absolute';\n  node.style.left = '-10000px';\n  node.style.top = 'auto';\n  node.style.width = '1px';\n  node.style.height = '1px';\n  node.style.overflow = 'hidden';\n  return node;\n}\n","import {\n  pointIntersectsRect,\n  scaleUp,\n  scaleDown\n} from '../UI/utils'; \n\n/**\n * Insert an element at a point within the document.\n * This algorithm will only insert within an element amidst it's text content.\n *\n * @param {Element} el The element to be inserted\n * @param {Number} x The x coordinate of the point\n * @param {Number} y The y coordinate of the point\n * @param {Number} pageNumber The page number to limit elements to\n * @param {Boolean} insertBefore Whether the element is to be inserted before or after x\n * @return {Boolean} True if element was able to be inserted, otherwise false\n */\nexport default function insertElementWithinElement(el, x, y, pageNumber, insertBefore) {\n  const OFFSET_ADJUST = 2;\n\n  // If inserting before adjust `x` by looking for element a few px to the right\n  // Otherwise adjust a few px to the left\n  // This is to allow a little tolerance by searching within the box, instead\n  // of getting a false negative by testing right on the border.\n  x = Math.max(x + (OFFSET_ADJUST * (insertBefore ? 1 : -1)), 0);\n\n  let node = textLayerElementFromPoint(x, y + OFFSET_ADJUST, pageNumber);\n  if (!node) {\n    return false;\n  }\n  \n  // Now that node has been found inverse the adjustment for `x`.\n  // This is done to accomodate tolerance by cutting off on the outside of the\n  // text boundary, instead of missing a character by cutting off within.\n  x = x + (OFFSET_ADJUST * (insertBefore ? -1 : 1));\n\n  let svg = document.querySelector(`svg[data-pdf-annotate-page=\"${pageNumber}\"]`);\n  let left = scaleDown(svg, {left: node.getBoundingClientRect().left}).left - svg.getBoundingClientRect().left;\n  let temp = node.cloneNode(true);\n  let head = temp.innerHTML.split('');\n  let tail = [];\n\n  // Insert temp off screen\n  temp.style.position = 'absolute';\n  temp.style.top = '-10000px';\n  temp.style.left = '-10000px';\n  document.body.appendChild(temp);\n\n  while (head.length) {\n    // Don't insert within HTML tags\n    if (head[head.length - 1] === '>') {\n      while(head.length) {\n        tail.unshift(head.pop());\n        if (tail[0] === '<') {\n          break;\n        }\n      }\n    }\n    \n    // Check if width of temp based on current head value satisfies x\n    temp.innerHTML = head.join('');\n    let width = scaleDown(svg, {width: temp.getBoundingClientRect().width}).width;\n    if (left + width <= x) {\n      break;\n    }\n    tail.unshift(head.pop());\n  }\n  \n  // Update original node with new markup, including element to be inserted\n  node.innerHTML = head.join('') + el.outerHTML + tail.join('');\n  temp.parentNode.removeChild(temp);\n\n  return true;\n}\n\n/**\n * Get a text layer element at a given point on a page\n *\n * @param {Number} x The x coordinate of the point\n * @param {Number} y The y coordinate of the point\n * @param {Number} pageNumber The page to limit elements to\n * @return {Element} First text layer element found at the point\n */\nfunction textLayerElementFromPoint(x, y, pageNumber) {\n  let svg = document.querySelector(`svg[data-pdf-annotate-page=\"${pageNumber}\"]`);\n  let rect = svg.getBoundingClientRect();\n  y = scaleUp(svg, {y}).y + rect.top;\n  x = scaleUp(svg, {x}).x + rect.left;\n  return [...svg.parentNode.querySelectorAll('.textLayer [data-canvas-width]')].filter((el) => {\n    return pointIntersectsRect(x, y, el.getBoundingClientRect());\n  })[0];\n}\n","import insertElementWithinElement from './insertElementWithinElement';\nimport { pointIntersectsRect } from '../UI/utils';\nimport { scaleUp } from '../UI/utils'; \n\n/**\n * Insert an element at a point within the document.\n * This algorithm will try to insert between elements if possible.\n * It will however use `insertElementWithinElement` if it is more accurate.\n *\n * @param {Element} el The element to be inserted\n * @param {Number} x The x coordinate of the point\n * @param {Number} y The y coordinate of the point\n * @param {Number} pageNumber The page number to limit elements to\n * @return {Boolean} True if element was able to be inserted, otherwise false\n */\nexport default function insertElementWithinChildren(el, x, y, pageNumber) {\n  // Try and use most accurate method of inserting within an element\n  if (insertElementWithinElement(el, x, y, pageNumber, true)) {\n    return true;\n  }\n\n  // Fall back to inserting between elements\n  let svg = document.querySelector(`svg[data-pdf-annotate-page=\"${pageNumber}\"]`);\n  let rect = svg.getBoundingClientRect();\n  let nodes = [...svg.parentNode.querySelectorAll('.textLayer > div')];\n\n  y = scaleUp(svg, {y}).y + rect.top;\n  x = scaleUp(svg, {x}).x + rect.left;\n\n  // Find the best node to insert before\n  for (let i=0, l=nodes.length; i<l; i++) {\n    let n = nodes[i];\n    let r = n.getBoundingClientRect();\n    if (y <= r.top) {\n      n.parentNode.insertBefore(el, n);\n      return true;\n    }\n  }\n\n  // If all else fails try to append to the bottom\n  let textLayer = svg.parentNode.querySelector('.textLayer');\n  if (textLayer) {\n    let textRect = textLayer.getBoundingClientRect();\n    if (pointIntersectsRect(x, y, textRect)) {\n      textLayer.appendChild(el);\n      return true;\n    }\n  }\n\n  return false;\n}\n","/**\n * Insert a comment into the DOM to be available by screen reader\n *\n * @param {Object} comment The comment to be inserted\n */\nexport default function insertScreenReaderComment(comment) {\n  if (!comment) {\n    return;\n  }\n\n  let list = document.querySelector(`#pdf-annotate-screenreader-${comment.annotation} ol`);\n  if (list) {\n    let item = document.createElement('li');\n    item.setAttribute('id', `pdf-annotate-screenreader-comment-${comment.id}`);\n    item.appendChild(document.createTextNode(`${comment.content}`));\n    list.appendChild(item);\n  }\n}\n","import PDFJSAnnotate from '../PDFJSAnnotate';\nimport insertScreenReaderComment from './insertScreenReaderComment';\n\n/**\n * Insert the comments into the DOM to be available by screen reader\n *\n * Example output:\n *   <div class=\"screenReaderOnly\">\n *    <div>Begin highlight 1</div>\n *    <ol aria-label=\"Comments\">\n *      <li>Foo</li>\n *      <li>Bar</li>\n *      <li>Baz</li>\n *      <li>Qux</li>\n *    </ol>\n *  </div>\n *  <div>Some highlighted text goes here...</div>\n *  <div class=\"screenReaderOnly\">End highlight 1</div>\n *\n * NOTE: `screenReaderOnly` is not a real class, just used for brevity\n *\n * @param {String} documentId The ID of the document\n * @param {String} annotationId The ID of the annotation\n * @param {Array} [comments] Optionally preloaded comments to be rendered\n * @return {Promise}\n */\nexport default function renderScreenReaderComments(documentId, annotationId, comments) {\n  let promise;\n\n  if (Array.isArray(comments)) {\n    promise = Promise.resolve(comments);\n  } else {\n    promise = PDFJSAnnotate.getStoreAdapter().getComments(documentId, annotationId);\n  }\n\n  return promise.then((comments) => {\n    // Node needs to be found by querying DOM as it may have been inserted as innerHTML\n    // leaving `screenReaderNode` as an invalid reference (see `insertElementWithinElement`).\n    let node = document.getElementById(`pdf-annotate-screenreader-${annotationId}`);\n    if (node) { \n      let list = document.createElement('ol');\n      list.setAttribute('id', `pdf-annotate-screenreader-comment-list-${annotationId}`);\n      list.setAttribute('aria-label', 'Comments');\n      node.appendChild(list);\n      comments.forEach(insertScreenReaderComment);\n    }\n  });\n}\n","import createScreenReaderOnly from './createScreenReaderOnly';\nimport insertElementWithinChildren from './insertElementWithinChildren';\nimport insertElementWithinElement from './insertElementWithinElement';\nimport renderScreenReaderComments from './renderScreenReaderComments';\n\n// Annotation types that support comments\nconst COMMENT_TYPES = ['highlight', 'point', 'area'];\n\n/**\n * Insert a hint into the DOM for screen readers for a specific annotation.\n *\n * @param {Object} annotation The annotation to insert a hint for\n * @param {Number} num The number of the annotation out of all annotations of the same type\n */\nexport default function insertScreenReaderHint(annotation, num = 0) {\n  switch (annotation.type) {\n    case 'highlight':\n    case 'strikeout':\n      let rects = annotation.rectangles;\n      let first = rects[0];\n      let last = rects[rects.length - 1];\n\n      insertElementWithinElement(\n        createScreenReaderOnly(`Begin ${annotation.type} annotation ${num}`, annotation.id),\n        first.x, first.y, annotation.page, true\n      );\n\n      insertElementWithinElement(\n        createScreenReaderOnly(`End ${annotation.type} annotation ${num}`, `${annotation.id}-end`),\n        last.x + last.width, last.y, annotation.page, false\n      );\n      break;\n\n    case 'textbox':\n    case 'point':\n      let text = annotation.type === 'textbox' ? ` (content: ${annotation.content})` : '';\n\n      insertElementWithinChildren(\n        createScreenReaderOnly(`${annotation.type} annotation ${num}${text}`, annotation.id),\n        annotation.x, annotation.y, annotation.page\n      );\n      break;\n\n    case 'drawing':\n    case 'area':\n      let x = typeof annotation.x !== 'undefined' ? annotation.x : annotation.lines[0][0];\n      let y = typeof annotation.y !== 'undefined' ? annotation.y : annotation.lines[0][1];\n\n      insertElementWithinChildren(\n        createScreenReaderOnly(`Unlabeled drawing`, annotation.id),\n        x, y, annotation.page\n      );\n      break;\n  }\n\n  // Include comments in screen reader hint\n  if (COMMENT_TYPES.includes(annotation.type)) {\n    renderScreenReaderComments(annotation.documentId, annotation.id);\n  }\n}\n","import insertScreenReaderHint from './insertScreenReaderHint';\nimport renderScreenReaderHints from './renderScreenReaderHints';\nimport insertScreenReaderComment from './insertScreenReaderComment';\nimport renderScreenReaderComments from './renderScreenReaderComments';\nimport { addEventListener } from '../UI/event';\nimport PDFJSAnnotate from '../PDFJSAnnotate';\n\n/**\n * Initialize the event handlers for keeping screen reader hints synced with data\n */\nexport default function initEventHandlers() {\n  addEventListener('annotation:add', (documentId, pageNumber, annotation) => {\n    reorderAnnotationsByType(documentId, pageNumber, annotation.type);\n  });\n  addEventListener('annotation:edit', (documentId, annotationId, annotation) => {\n    reorderAnnotationsByType(documentId, annotation.page, annotation.type);\n  });\n  addEventListener('annotation:delete', removeAnnotation);\n  addEventListener('comment:add', insertComment);\n  addEventListener('comment:delete', removeComment);\n}\n\n/**\n * Reorder the annotation numbers by annotation type\n *\n * @param {String} documentId The ID of the document\n * @param {Number} pageNumber The page number of the annotations\n * @param {Strig} type The annotation type\n */\nfunction reorderAnnotationsByType(documentId, pageNumber, type) {\n  PDFJSAnnotate.getStoreAdapter().getAnnotations(documentId, pageNumber)\n    .then((annotations) => {\n      return annotations.annotations.filter((a) => {\n        return a.type === type;\n      });\n    })\n    .then((annotations) => {\n      annotations.forEach((a) => {\n        removeAnnotation(documentId, a.id);\n      });\n\n      return annotations;\n    })\n    .then(renderScreenReaderHints);\n}\n\n/**\n * Remove the screen reader hint for an annotation\n *\n * @param {String} documentId The ID of the document\n * @param {String} annotationId The Id of the annotation\n */\nfunction removeAnnotation(documentId, annotationId) {\n  removeElementById(`pdf-annotate-screenreader-${annotationId}`);\n  removeElementById(`pdf-annotate-screenreader-${annotationId}-end`);\n}\n\n/**\n * Insert a screen reader hint for a comment\n *\n * @param {String} documentId The ID of the document\n * @param {String} annotationId The ID of tha assocated annotation\n * @param {Object} comment The comment to insert a hint for\n */\nfunction insertComment(documentId, annotationId, comment) {\n  let list = document.querySelector(`pdf-annotate-screenreader-comment-list-${annotationId}`);\n  let promise;\n\n  if (!list) {\n    promise = renderScreenReaderComments(documentId, annotationId, []).then(() => {\n      list = document.querySelector(`pdf-annotate-screenreader-comment-list-${annotationId}`);\n      return true;\n    });\n  } else {\n    promise = Promise.resolve(true);\n  }\n\n  promise.then(() => {\n    insertScreenReaderComment(comment);\n  });\n}\n\n/**\n * Remove a screen reader hint for a comment\n *\n * @param {String} documentId The ID of the document\n * @param {String} commentId The ID of the comment\n */\nfunction removeComment(documentId, commentId) {\n  removeElementById(`pdf-annotate-screenreader-comment-${commentId}`);\n}\n\n/**\n * Remove an element from the DOM by it's ID if it exists\n *\n * @param {String} elementID The ID of the element to be removed\n */\nfunction removeElementById(elementId) {\n  let el = document.getElementById(elementId);\n  if (el) {\n    el.parentNode.removeChild(el);\n  }\n}\n","import insertScreenReaderHint from './insertScreenReaderHint';\nimport initEventHandlers from './initEventHandlers';\n\n// TODO This is not the right place for this to live\ninitEventHandlers();\n\n/**\n * Insert hints into the DOM for screen readers.\n *\n * @param {Array} annotations The annotations that hints are inserted for\n */\nexport default function renderScreenReaderHints(annotations) {\n  annotations = Array.isArray(annotations) ? annotations : [];\n\n  // Insert hints for each type\n  Object.keys(SORT_TYPES).forEach((type) => {\n    let sortBy = SORT_TYPES[type];\n    annotations\n      .filter((a) => a.type === type)\n      .sort(sortBy)\n      .forEach((a, i) => insertScreenReaderHint(a, i + 1));\n  });\n}\n\n// Sort annotations first by y, then by x.\n// This allows hints to be injected in the order they appear,\n// which makes numbering them easier.\nfunction sortByPoint(a, b) {\n  if (a.y < b.y) {\n    return a.x - b.x;\n  } else {\n    return 1;\n  }\n}\n\n// Sort annotation by it's first rectangle\nfunction sortByRectPoint(a, b) {\n  return sortByPoint(a.rectangles[0], b.rectangles[0]);\n}\n\n// Sort annotation by it's first line\nfunction sortByLinePoint(a, b) {\n  let lineA = a.lines[0];\n  let lineB = b.lines[0];\n  return sortByPoint(\n    {x: lineA[0], y: lineA[1]},\n    {x: lineB[0], y: lineB[1]}\n  );\n}\n\n// Arrange supported types and associated sort methods\nconst SORT_TYPES = {\n  'highlight': sortByRectPoint,\n  'strikeout': sortByRectPoint,\n  'drawing': sortByLinePoint,\n  'textbox': sortByPoint,\n  'point': sortByPoint,\n  'area': sortByPoint\n};\n\n","import PDFJSAnnotate from '../PDFJSAnnotate';\n\nimport appendChild from '../render/appendChild';\nimport {\n  addEventListener,\n  removeEventListener\n} from './event';\nimport {\n  BORDER_COLOR,\n  disableUserSelect,\n  enableUserSelect,\n  findSVGContainer,\n  findSVGAtPoint,\n  getAnnotationRect,\n  getMetadata,\n  scaleDown,\n  scaleUp\n} from './utils';\n\nlet _enabled = false;\nlet isDragging = false, overlay;\nlet dragOffsetX, dragOffsetY, dragStartX, dragStartY;\nconst OVERLAY_BORDER_SIZE = 3;\n\n/**\n * Create an overlay for editing an annotation.\n *\n * @param {Element} target The annotation element to apply overlay for\n */\nfunction createEditOverlay(target) {\n  destroyEditOverlay();\n\n  overlay = document.createElement('div');\n  let anchor = document.createElement('a');\n  let parentNode = findSVGContainer(target).parentNode;\n  let id = target.getAttribute('data-pdf-annotate-id');\n  let rect = getAnnotationRect(target);\n  let styleLeft = rect.left - OVERLAY_BORDER_SIZE;\n  let styleTop = rect.top - OVERLAY_BORDER_SIZE;\n  \n  overlay.setAttribute('id', 'pdf-annotate-edit-overlay');\n  overlay.setAttribute('data-target-id', id);\n  overlay.style.boxSizing = 'content-box';\n  overlay.style.position = 'absolute';\n  overlay.style.top = `${styleTop}px`;\n  overlay.style.left = `${styleLeft}px`;\n  overlay.style.width = `${rect.width}px`;\n  overlay.style.height = `${rect.height}px`;\n  overlay.style.border = `${OVERLAY_BORDER_SIZE}px solid ${BORDER_COLOR}`;\n  overlay.style.borderRadius = `${OVERLAY_BORDER_SIZE}px`;\n\n  anchor.innerHTML = '';\n  anchor.setAttribute('href', 'javascript://');\n  anchor.style.background = '#fff';\n  anchor.style.borderRadius = '20px';\n  anchor.style.border = '1px solid #bbb';\n  anchor.style.color = '#bbb';\n  anchor.style.fontSize = '16px';\n  anchor.style.padding = '2px';\n  anchor.style.textAlign = 'center';\n  anchor.style.textDecoration = 'none';\n  anchor.style.position = 'absolute';\n  anchor.style.top = '-13px';\n  anchor.style.right = '-13px';\n  anchor.style.width = '25px';\n  anchor.style.height = '25px';\n  \n  overlay.appendChild(anchor);\n  parentNode.appendChild(overlay);\n  document.addEventListener('click', handleDocumentClick);\n  document.addEventListener('keyup', handleDocumentKeyup);\n  document.addEventListener('mousedown', handleDocumentMousedown);\n  anchor.addEventListener('click', deleteAnnotation);\n  anchor.addEventListener('mouseover', () => {\n    anchor.style.color = '#35A4DC';\n    anchor.style.borderColor = '#999';\n    anchor.style.boxShadow = '0 1px 1px #ccc';\n  });\n  anchor.addEventListener('mouseout', () => {\n    anchor.style.color = '#bbb';\n    anchor.style.borderColor = '#bbb';\n    anchor.style.boxShadow = '';\n  });\n  overlay.addEventListener('mouseover', () => {\n    if (!isDragging) { anchor.style.display = ''; }\n  });\n  overlay.addEventListener('mouseout', () => {\n    anchor.style.display = 'none';\n  });\n}\n\n/**\n * Destroy the edit overlay if it exists.\n */\nfunction destroyEditOverlay() {\n  if (overlay) {\n    overlay.parentNode.removeChild(overlay);\n    overlay = null;\n  }\n\n  document.removeEventListener('click', handleDocumentClick);\n  document.removeEventListener('keyup', handleDocumentKeyup);\n  document.removeEventListener('mousedown', handleDocumentMousedown);\n  document.removeEventListener('mousemove', handleDocumentMousemove);\n  document.removeEventListener('mouseup', handleDocumentMouseup);\n  enableUserSelect();\n}\n\n/**\n * Delete currently selected annotation\n */\nfunction deleteAnnotation() {\n  if (!overlay) { return; }\n\n  let annotationId = overlay.getAttribute('data-target-id');\n  let nodes = document.querySelectorAll(`[data-pdf-annotate-id=\"${annotationId}\"]`);\n  let svg = overlay.parentNode.querySelector('svg.annotationLayer');\n  let { documentId } = getMetadata(svg);\n\n  [...nodes].forEach((n) => {\n    n.parentNode.removeChild(n);\n  });\n  \n  PDFJSAnnotate.getStoreAdapter().deleteAnnotation(documentId, annotationId);\n\n  destroyEditOverlay();\n}\n\n/**\n * Handle document.click event\n *\n * @param {Event} e The DOM event that needs to be handled\n */\nfunction handleDocumentClick(e) {\n  if (!findSVGAtPoint(e.clientX, e.clientY)) { return; }\n\n  // Remove current overlay\n  let overlay = document.getElementById('pdf-annotate-edit-overlay');\n  if (overlay) {\n    if (isDragging || e.target === overlay) {\n      return;\n    }\n\n    destroyEditOverlay();\n  }\n}\n\n/**\n * Handle document.keyup event\n *\n * @param {Event} e The DOM event that needs to be handled\n */\nfunction handleDocumentKeyup(e) {\n  if (overlay && e.keyCode === 46 &&\n      e.target.nodeName.toLowerCase() !== 'textarea' &&\n      e.target.nodeName.toLowerCase() !== 'input') {\n    deleteAnnotation();\n  }\n}\n\n/**\n * Handle document.mousedown event\n *\n * @param {Event} e The DOM event that needs to be handled\n */\nfunction handleDocumentMousedown(e) {\n  if (e.target !== overlay) { return; }\n\n  // Highlight and strikeout annotations are bound to text within the document.\n  // It doesn't make sense to allow repositioning these types of annotations.\n  let annotationId = overlay.getAttribute('data-target-id');\n  let target = document.querySelector(`[data-pdf-annotate-id=\"${annotationId}\"]`);\n  let type = target.getAttribute('data-pdf-annotate-type');\n\n  if (type === 'highlight' || type === 'strikeout') { return; }\n\n  isDragging = true;\n  dragOffsetX = e.clientX;\n  dragOffsetY = e.clientY;\n  dragStartX = overlay.offsetLeft;\n  dragStartY = overlay.offsetTop;\n\n  overlay.style.background = 'rgba(255, 255, 255, 0.7)';\n  overlay.style.cursor = 'move';\n  overlay.querySelector('a').style.display = 'none';\n\n  document.addEventListener('mousemove', handleDocumentMousemove);\n  document.addEventListener('mouseup', handleDocumentMouseup);\n  disableUserSelect();\n}\n\n/**\n * Handle document.mousemove event\n *\n * @param {Event} e The DOM event that needs to be handled\n */\nfunction handleDocumentMousemove(e) {\n  let annotationId = overlay.getAttribute('data-target-id');\n  let parentNode = overlay.parentNode;\n  let rect = parentNode.getBoundingClientRect();\n  let y = (dragStartY + (e.clientY - dragOffsetY));\n  let x = (dragStartX + (e.clientX - dragOffsetX));\n  let minY = 0;\n  let maxY = rect.height;\n  let minX = 0;\n  let maxX = rect.width;\n\n  if (y > minY && y + overlay.offsetHeight < maxY) {\n    overlay.style.top = `${y}px`;\n  }\n\n  if (x > minX && x + overlay.offsetWidth < maxX) {\n    overlay.style.left = `${x}px`;\n  }\n}\n\n/**\n * Handle document.mouseup event\n *\n * @param {Event} e The DOM event that needs to be handled\n */\nfunction handleDocumentMouseup(e) {\n  let annotationId = overlay.getAttribute('data-target-id');\n  let target = document.querySelectorAll(`[data-pdf-annotate-id=\"${annotationId}\"]`);\n  let type = target[0].getAttribute('data-pdf-annotate-type');\n  let svg = overlay.parentNode.querySelector('svg.annotationLayer');\n  let { documentId } = getMetadata(svg);\n  \n  overlay.querySelector('a').style.display = '';\n\n  function getDelta(propX, propY) {\n    return calcDelta(parseInt(target[0].getAttribute(propX), 10), parseInt(target[0].getAttribute(propY), 10));\n  }\n\n  function calcDelta(x, y) {\n    return {\n      deltaX: OVERLAY_BORDER_SIZE + scaleDown(svg, {x: overlay.offsetLeft}).x - x,\n      deltaY: OVERLAY_BORDER_SIZE + scaleDown(svg, {y: overlay.offsetTop}).y - y\n    };\n  }\n\n  PDFJSAnnotate.getStoreAdapter().getAnnotation(documentId, annotationId).then((annotation) => {\n    if (['area', 'highlight', 'point', 'textbox'].indexOf(type) > -1) {\n      let { deltaX, deltaY } = getDelta('x', 'y');\n      [...target].forEach((t, i) => {\n        if (deltaY !== 0) {\n          let modelY = parseInt(t.getAttribute('y'), 10) + deltaY;\n          let viewY = modelY;\n\n          if (type === 'textbox') {\n            viewY += annotation.size;\n          }\n\n          if (type === 'point') {\n            viewY = scaleUp(svg, { viewY }).viewY;\n          }\n\n          t.setAttribute('y', viewY);\n          if (annotation.rectangles.length) {\n            annotation.rectangles[i].y = modelY;\n          } else if (annotation.y) {\n            annotation.y = modelY;\n          }\n        }\n        if (deltaX !== 0) {\n          let modelX = parseInt(t.getAttribute('x'), 10) + deltaX;\n          let viewX = modelX;\n\n          if (type === 'point') {\n            viewX = scaleUp(svg, { viewX }).viewX;\n          }\n\n          t.setAttribute('x', viewX);\n          if (annotation.rectangles.length) {\n            annotation.rectangles[i].x = modelX;\n          } else if (annotation.x) {\n            annotation.x = modelX;\n          }\n        }\n      });\n    // } else if (type === 'strikeout') {\n    //   let { deltaX, deltaY } = getDelta('x1', 'y1');\n    //   [...target].forEach(target, (t, i) => {\n    //     if (deltaY !== 0) {\n    //       t.setAttribute('y1', parseInt(t.getAttribute('y1'), 10) + deltaY);\n    //       t.setAttribute('y2', parseInt(t.getAttribute('y2'), 10) + deltaY);\n    //       annotation.rectangles[i].y = parseInt(t.getAttribute('y1'), 10);\n    //     }\n    //     if (deltaX !== 0) {\n    //       t.setAttribute('x1', parseInt(t.getAttribute('x1'), 10) + deltaX);\n    //       t.setAttribute('x2', parseInt(t.getAttribute('x2'), 10) + deltaX);\n    //       annotation.rectangles[i].x = parseInt(t.getAttribute('x1'), 10);\n    //     }\n    //   });\n    } else if (type === 'drawing') {\n      let rect = scaleDown(svg, getAnnotationRect(target[0]));\n      let [originX, originY] = annotation.lines[0];\n      let { deltaX, deltaY } = calcDelta(originX, originY);\n\n      // origin isn't necessarily at 0/0 in relation to overlay x/y\n      // adjust the difference between overlay and drawing coords\n      deltaY += (originY - rect.top);\n      deltaX += (originX - rect.left);\n\n      annotation.lines.forEach((line, i) => {\n        let [x, y] = annotation.lines[i];\n        annotation.lines[i][0] = x + deltaX;\n        annotation.lines[i][1] = y + deltaY;\n      });\n\n      target[0].parentNode.removeChild(target[0]);\n      appendChild(svg, annotation);\n    }\n\n    PDFJSAnnotate.getStoreAdapter().editAnnotation(documentId, annotationId, annotation);\n  });\n\n  setTimeout(() => {\n    isDragging = false;\n  }, 0);\n\n  overlay.style.background = '';\n  overlay.style.cursor = '';\n\n  document.removeEventListener('mousemove', handleDocumentMousemove);\n  document.removeEventListener('mouseup', handleDocumentMouseup);\n  enableUserSelect();\n}\n\n/**\n * Handle annotation.click event\n *\n * @param {Element} e The annotation element that was clicked\n */\nfunction handleAnnotationClick(target) {\n  createEditOverlay(target);\n}\n\n/**\n * Enable edit mode behavior.\n */\nexport function enableEdit () {\n  if (_enabled) { return; }\n\n  _enabled = true;\n  addEventListener('annotation:click', handleAnnotationClick);\n};\n\n/**\n * Disable edit mode behavior.\n */\nexport function disableEdit () {\n  destroyEditOverlay();\n\n  if (!_enabled) { return; }\n\n  _enabled = false;\n  removeEventListener('annotation:click', handleAnnotationClick);\n};\n\n","import PDFJSAnnotate from '../PDFJSAnnotate';\nimport appendChild from '../render/appendChild';\nimport {\n  disableUserSelect,\n  enableUserSelect,\n  findSVGAtPoint,\n  getMetadata,\n  scaleDown\n} from './utils';\n\nlet _enabled = false;\nlet _penSize;\nlet _penColor;\nlet path;\nlet lines;\n\n/**\n * Handle document.mousedown event\n */\nfunction handleDocumentMousedown() {\n  path = null;\n  lines = [];\n\n  document.addEventListener('mousemove', handleDocumentMousemove);\n  document.addEventListener('mouseup', handleDocumentMouseup);\n}\n\n/**\n * Handle document.mouseup event\n *\n * @param {Event} e The DOM event to be handled\n */\nfunction handleDocumentMouseup(e) {\n  let svg;\n  if (lines.length > 1 && (svg = findSVGAtPoint(e.clientX, e.clientY))) {\n    let { documentId, pageNumber } = getMetadata(svg);\n\n    PDFJSAnnotate.getStoreAdapter().addAnnotation(documentId, pageNumber, {\n        type: 'drawing',\n        width: _penSize,\n        color: _penColor,\n        lines\n      }\n    ).then((annotation) => {\n      if (path) {\n        svg.removeChild(path);\n      }\n\n      appendChild(svg, annotation);\n    });\n  }\n\n  document.removeEventListener('mousemove', handleDocumentMousemove);\n  document.removeEventListener('mouseup', handleDocumentMouseup);\n}\n\n/**\n * Handle document.mousemove event\n *\n * @param {Event} e The DOM event to be handled\n */\nfunction handleDocumentMousemove(e) {\n  savePoint(e.clientX, e.clientY);\n}\n\n/**\n * Handle document.keyup event\n *\n * @param {Event} e The DOM event to be handled\n */\nfunction handleDocumentKeyup(e) {\n  // Cancel rect if Esc is pressed\n  if (e.keyCode === 27) {\n    lines = null;\n    path.parentNode.removeChild(path);\n    document.removeEventListener('mousemove', handleDocumentMousemove);\n    document.removeEventListener('mouseup', handleDocumentMouseup);\n  }\n}\n\n/**\n * Save a point to the line being drawn.\n *\n * @param {Number} x The x coordinate of the point\n * @param {Number} y The y coordinate of the point\n */\nfunction savePoint(x, y) {\n  let svg = findSVGAtPoint(x, y);\n  if (!svg) {\n    return;\n  }\n\n  let rect = svg.getBoundingClientRect();\n  let point = scaleDown(svg, {\n    x: x - rect.left,\n    y: y - rect.top\n  });\n\n  lines.push([point.x, point.y]);\n\n  if (lines.length <= 1) {\n    return;\n  }\n\n  if (path) {\n    svg.removeChild(path);\n  }\n\n  path = appendChild(svg, {\n    type: 'drawing',\n    color: _penColor,\n    width: _penSize,\n    lines\n  });\n}\n\n/**\n * Set the attributes of the pen.\n *\n * @param {Number} penSize The size of the lines drawn by the pen\n * @param {String} penColor The color of the lines drawn by the pen\n */\nexport function setPen(penSize = 1, penColor = '000000') {\n  _penSize = parseInt(penSize, 10);\n  _penColor = penColor;\n}\n\n/**\n * Enable the pen behavior\n */\nexport function enablePen() {\n  if (_enabled) { return; }\n\n  _enabled = true;\n  document.addEventListener('mousedown', handleDocumentMousedown);\n  document.addEventListener('keyup', handleDocumentKeyup);\n  disableUserSelect();\n}\n\n/**\n * Disable the pen behavior\n */\nexport function disablePen() {\n  if (!_enabled) { return; }\n\n  _enabled = false;\n  document.removeEventListener('mousedown', handleDocumentMousedown);\n  document.removeEventListener('keyup', handleDocumentKeyup);\n  enableUserSelect();\n}\n\n","import PDFJSAnnotate from '../PDFJSAnnotate';\nimport appendChild from '../render/appendChild';\nimport {\n  BORDER_COLOR,\n  findSVGAtPoint,\n  getMetadata,\n  scaleDown\n} from './utils';\nimport {\n  setEdit\n} from './edit'\n\nlet _enabled = false;\nlet _pointColor;\nlet clientX;\nlet clientY;\n\n/**\n * Handle document.mouseup event\n *\n * @param {Event} The DOM event to be handled\n */\nfunction handleDocumentMouseup(e) {\n  if (!findSVGAtPoint(e.clientX, e.clientY)) {\n    return;\n  }\n  clientX = e.clientX;\n  clientY = e.clientY;\n  savePoint();\n}\n\n/**\n * Handle input.blur event\n */\nfunction handleInputBlur() {\n  savePoint();\n}\n\n/**\n * Handle input.keyup event\n *\n * @param {Event} e The DOM event to handle\n */\nfunction handleInputKeyup(e) {\n  if (e.keyCode === 27) {\n    // closeInput();\n  } else if (e.keyCode === 13) {\n    savePoint();\n  }\n}\n\n/**\n * Save a new point annotation from input\n */\nfunction savePoint() {\n  let svg = findSVGAtPoint(clientX, clientY);\n  if (!svg) {\n    return;\n  }\n\n  let rect = svg.getBoundingClientRect();\n  let { documentId, pageNumber } = getMetadata(svg);\n  let annotation = Object.assign({\n      type: 'point',\n      color: _pointColor\n    }, scaleDown(svg, {\n      x: clientX - rect.left,\n      y: clientY - rect.top\n    })\n  );\n\n  PDFJSAnnotate.getStoreAdapter().addAnnotation(documentId, pageNumber, annotation)\n    .then((annotation) => {\n      appendChild(svg, annotation);\n      PDFJSAnnotate.getStoreAdapter().getAnnotations(documentId, pageNumber)\n        .then((annotations) => {\n          setEdit(annotation)\n        });\n    });\n}\n\n/**\n * Change point color\n */\nexport function setPoint(pointColor = 'EE0512') {\n  _pointColor = pointColor;\n}\n\n/**\n * Enable point annotation behavior\n */\nexport function enablePoint() {\n  if (_enabled) { return; }\n\n  _enabled = true;\n  document.addEventListener('mouseup', handleDocumentMouseup);\n}\n\n/**\n * Disable point annotation behavior\n */\nexport function disablePoint() {\n  if (!_enabled) { return; }\n\n  _enabled = false;\n  document.removeEventListener('mouseup', handleDocumentMouseup);\n}\n","import PDFJSAnnotate from '../PDFJSAnnotate';\nimport appendChild from '../render/appendChild';\nimport {\n  disableUserSelect,\n  enableUserSelect,\n  findSVGAtPoint,\n  getMetadata,\n  getOffset,\n  scaleDown,\n  scaleUp\n} from './utils';\n\nlet _enabled = false;\nlet _type;\nlet _highlightColor;\nlet _strikeoutColor;\nlet _areaColor;\nlet overlay;\nlet originY;\nlet originX;\n\n/**\n * Get the current window selection as rects\n *\n * @return {Array} An Array of rects\n */\nfunction getSelectionRects() {\n  try {\n    let selection = window.getSelection();\n    let range = selection.getRangeAt(0);\n    let rects = range.getClientRects();\n\n    if (rects.length > 0 &&\n        rects[0].width > 0 &&\n        rects[0].height > 0) {\n      return rects;\n    }\n  } catch (e) {}\n  \n  return null;\n}\n\n/**\n * Handle document.mousedown event\n *\n * @param {Event} e The DOM event to handle\n */\nfunction handleDocumentMousedown(e) {\n  let svg;\n  if (_type !== 'area' || !(svg = findSVGAtPoint(e.clientX, e.clientY))) {\n    return;\n  }\n\n  let rect = svg.getBoundingClientRect();\n  originY = e.clientY;\n  originX = e.clientX;\n\n  overlay = document.createElement('div');\n  overlay.style.position = 'absolute';\n  overlay.style.top = `${originY - rect.top}px`;\n  overlay.style.left = `${originX - rect.left}px`;\n  overlay.style.border = `3px solid #${_areaColor}`;\n  overlay.style.borderRadius = '3px';\n  svg.parentNode.appendChild(overlay);\n\n  document.addEventListener('mousemove', handleDocumentMousemove);\n  disableUserSelect();\n}\n\n/**\n * Handle document.mousemove event\n *\n * @param {Event} e The DOM event to handle\n */\nfunction handleDocumentMousemove(e) {\n  let svg = overlay.parentNode.querySelector('svg.annotationLayer');\n  let rect = svg.getBoundingClientRect();\n\n  if (originX + (e.clientX - originX) < rect.right) {\n    overlay.style.width = `${e.clientX - originX}px`;\n  }\n\n  if (originY + (e.clientY - originY) < rect.bottom) {\n    overlay.style.height = `${e.clientY - originY}px`;\n  }\n}\n\n/**\n * Handle document.mouseup event\n *\n * @param {Event} e The DOM event to handle\n */\nfunction handleDocumentMouseup(e) {\n  let rects;\n  if (_type !== 'area' && (rects = getSelectionRects())) {\n    let svg = findSVGAtPoint(rects[0].left, rects[0].top);\n    saveRect(_type, [...rects].map((r) => {\n      return {\n        top: r.top,\n        left: r.left,\n        width: r.width,\n        height: r.height\n      };\n    }));\n  } else if (_type === 'area' && overlay) {\n    let svg = overlay.parentNode.querySelector('svg.annotationLayer');\n    let rect = svg.getBoundingClientRect();\n    saveRect(_type, [{\n      top: parseInt(overlay.style.top, 10) + rect.top,\n      left: parseInt(overlay.style.left, 10) + rect.left,\n      width: parseInt(overlay.style.width, 10),\n      height: parseInt(overlay.style.height, 10)\n    }]);\n\n    overlay.parentNode.removeChild(overlay);\n    overlay = null;\n\n    document.removeEventListener('mousemove', handleDocumentMousemove);\n    enableUserSelect();\n  }\n}\n\n/**\n * Handle document.keyup event\n *\n * @param {Event} e The DOM event to handle\n */\nfunction handleDocumentKeyup(e) {\n  // Cancel rect if Esc is pressed\n  if (e.keyCode === 27) {\n    let selection = window.getSelection();\n    selection.removeAllRanges();\n    if (overlay && overlay.parentNode) {\n      overlay.parentNode.removeChild(overlay);\n      overlay = null;\n      document.removeEventListener('mousemove', handleDocumentMousemove);\n    }\n  }\n}\n\n/**\n * Save a rect annotation\n *\n * @param {String} type The type of rect (area, highlight, strikeout)\n * @param {Array} rects The rects to use for annotation\n * @param {String} color The color of the rects\n */\nfunction saveRect(type, rects, color) {\n  let svg = findSVGAtPoint(rects[0].left, rects[0].top);\n  let node;\n  let annotation;\n\n  if (!svg) {\n    return;\n  }\n\n  let boundingRect = svg.getBoundingClientRect();\n\n  if (type === 'highlight') {\n    color = _highlightColor;\n  } else if (type === 'strikeout') {\n    color = _strikeoutColor;\n  } else if (type === 'area') {\n    color = _areaColor;\n  }\n\n  // Initialize the annotation\n  annotation = {\n    type,\n    color,\n    rectangles: [...rects].map((r) => {\n      let offset = 0;\n\n      if (type === 'strikeout') {\n        offset = r.height / 2;\n      }\n\n      return scaleDown(svg, {\n        y: (r.top + offset) - boundingRect.top,\n        x: r.left - boundingRect.left,\n        width: r.width,\n        height: r.height\n      });\n    }).filter((r) => r.width > 0 && r.height > 0 && r.x > -1 && r.y > -1)\n  };\n\n  // Short circuit if no rectangles exist\n  if (annotation.rectangles.length === 0) {\n    return;\n  }\n\n  // Special treatment for area as it only supports a single rect\n  if (type === 'area') {\n    let rect = annotation.rectangles[0];\n    delete annotation.rectangles;\n    annotation.x = rect.x;\n    annotation.y = rect.y;\n    annotation.width = rect.width;\n    annotation.height = rect.height;\n  }\n\n  let { documentId, pageNumber } = getMetadata(svg);\n\n  // Add the annotation\n  PDFJSAnnotate.getStoreAdapter().addAnnotation(documentId, pageNumber, annotation)\n    .then((annotation) => {\n      appendChild(svg, annotation);\n    });\n}\n\n/**\n * Change highlight color\n */\nexport function setHighlight(highlightColor = '741765') {\n  _highlightColor = highlightColor;\n}\n\n/**\n * Change strikeout color\n */\nexport function setStrikeout(strikeoutColor = 'EE0512') {\n  _strikeoutColor = strikeoutColor;\n}\n\n/**\n * Change area border color\n */\nexport function setArea(areaColor = 'EE0512') {\n  _areaColor = areaColor;\n}\n/**\n * Enable rect behavior\n */\nexport function enableRect(type) {\n  _type = type;\n\n  if (_enabled) { return; }\n\n  _enabled = true;\n  document.addEventListener('mouseup', handleDocumentMouseup);\n  document.addEventListener('mousedown', handleDocumentMousedown);\n  document.addEventListener('keyup', handleDocumentKeyup);\n}\n\n/**\n * Disable rect behavior\n */\nexport function disableRect() {\n  if (!_enabled) { return; }\n\n  _enabled = false;\n  document.removeEventListener('mouseup', handleDocumentMouseup);\n  document.removeEventListener('mousedown', handleDocumentMousedown);\n  document.removeEventListener('keyup', handleDocumentKeyup);\n}\n\n","import PDFJSAnnotate from '../PDFJSAnnotate';\nimport appendChild from '../render/appendChild';\nimport {\n  BORDER_COLOR,\n  findSVGAtPoint,\n  getMetadata,\n  scaleDown\n} from './utils';\n\nlet _enabled = false;\nlet input;\nlet _textSize;\nlet _textColor;\n\n/**\n * Handle document.mouseup event\n *\n * @param {Event} e The DOM event to handle\n */\nfunction handleDocumentMouseup(e) {\n  if (input || !findSVGAtPoint(e.clientX, e.clientY)) {\n    return;\n  }\n\n  input = document.createElement('input');\n  input.setAttribute('id', 'pdf-annotate-text-input');\n  input.setAttribute('placeholder', 'Enter text');\n  input.style.border = `3px solid ${BORDER_COLOR}`;\n  input.style.borderRadius = '3px';\n  input.style.position = 'absolute';\n  input.style.top = `${e.clientY}px`;\n  input.style.left = `${e.clientX}px`;\n  input.style.fontSize = `${_textSize}px`;\n\n  input.addEventListener('blur', handleInputBlur);\n  input.addEventListener('keyup', handleInputKeyup);\n\n  document.body.appendChild(input);\n  input.focus();\n}\n\n/**\n * Handle input.blur event\n */\nfunction handleInputBlur() {\n  saveText();\n}\n\n/**\n * Handle input.keyup event\n *\n * @param {Event} e The DOM event to handle\n */\nfunction handleInputKeyup(e) {\n  if (e.keyCode === 27) {\n    closeInput();\n  } else if (e.keyCode === 13) {\n    saveText();\n  }\n}\n\n/**\n * Save a text annotation from input\n */\nfunction saveText() {\n  if (input.value.trim().length > 0) {\n    let clientX = parseInt(input.style.left, 10);\n    let clientY = parseInt(input.style.top, 10);\n    let svg = findSVGAtPoint(clientX, clientY);\n    if (!svg) {\n      return;\n    }\n\n    let { documentId, pageNumber } = getMetadata(svg);\n    let rect = svg.getBoundingClientRect();\n    let annotation = Object.assign({\n        type: 'textbox',\n        size: _textSize,\n        color: _textColor,\n        content: input.value.trim()\n      }, scaleDown(svg, {\n        x: clientX - rect.left,\n        y: clientY -  rect.top,\n        width: input.offsetWidth,\n        height: input.offsetHeight\n      })\n    );\n\n    PDFJSAnnotate.getStoreAdapter().addAnnotation(documentId, pageNumber, annotation)\n      .then((annotation) => {\n        appendChild(svg, annotation);\n      });\n  }\n  \n  closeInput();\n}\n\n/**\n * Close the input\n */\nfunction closeInput() {\n  if (input) {\n    input.removeEventListener('blur', handleInputBlur);\n    input.removeEventListener('keyup', handleInputKeyup);\n    document.body.removeChild(input);\n    input = null;\n  }\n}\n\n/**\n * Set the text attributes\n *\n * @param {Number} textSize The size of the text\n * @param {String} textColor The color of the text\n */\nexport function setText(textSize = 12, textColor = '000000') {\n  _textSize = parseInt(textSize, 10);\n  _textColor = textColor;\n}\n\n\n/**\n * Enable text behavior\n */\nexport function enableText() {\n  if (_enabled) { return; }\n\n  _enabled = true;\n  document.addEventListener('mouseup', handleDocumentMouseup);\n}\n\n\n/**\n * Disable text behavior\n */\nexport function disableText() {\n  if (!_enabled) { return; }\n\n  _enabled = false;\n  document.removeEventListener('mouseup', handleDocumentMouseup);\n}\n\n","import PDFJSAnnotate from '../PDFJSAnnotate';\nimport renderScreenReaderHints from '../a11y/renderScreenReaderHints';\n\n// Template for creating a new page\nconst PAGE_TEMPLATE = `\n  <div style=\"visibility: hidden;\" class=\"page\" data-loaded=\"false\">\n    <div class=\"canvasWrapper\">\n      <canvas></canvas>\n    </div>\n    <svg class=\"annotationLayer\"></svg>\n    <div class=\"textLayer\"></div>\n  </div>\n`;\n\n/**\n * Create a new page to be appended to the DOM.\n *\n * @param {Number} pageNumber The page number that is being created\n * @return {HTMLElement}\n */\nexport function createPage(pageNumber) {\n  let temp = document.createElement('div');\n  temp.innerHTML = PAGE_TEMPLATE;\n\n  let page = temp.children[0];\n  let canvas = page.querySelector('canvas');\n\n  page.setAttribute('id', `pageContainer${pageNumber}`);\n  page.setAttribute('data-page-number', pageNumber);\n\n  canvas.mozOpaque = true;\n  canvas.setAttribute('id', `page${pageNumber}`);\n\n  return page;\n}\n\n/**\n * Render a page that has already been created.\n *\n * @param {Number} pageNumber The page number to be rendered\n * @param {Object} renderOptions The options for rendering\n * @return {Promise} Settled once rendering has completed\n *  A settled Promise will be either:\n *    - fulfilled: [pdfPage, annotations]\n *    - rejected: Error\n */\nexport function renderPage(pageNumber, renderOptions) {\n  let {\n    documentId,\n    pdfDocument,\n    scale,\n    rotate\n  } = renderOptions;\n\n  // Load the page and annotations\n  return Promise.all([\n    pdfDocument.getPage(pageNumber),\n    PDFJSAnnotate.getAnnotations(documentId, pageNumber)\n  ]).then(([pdfPage, annotations]) => {\n    let page = document.getElementById(`pageContainer${pageNumber}`);\n    let svg = page.querySelector('.annotationLayer');\n    let canvas = page.querySelector('.canvasWrapper canvas');\n    let canvasContext = canvas.getContext('2d', {alpha: false});\n    let viewport = pdfPage.getViewport(scale, rotate);\n    let transform = scalePage(pageNumber, viewport, canvasContext);\n\n    // Render the page\n    return Promise.all([\n      pdfPage.render({ canvasContext, viewport, transform }),\n      PDFJSAnnotate.render(svg, viewport, annotations)\n    ]).then(() => {\n      // Text content is needed for a11y, but is also necessary for creating\n      // highlight and strikeout annotations which require selecting text.\n      return pdfPage.getTextContent({normalizeWhitespace: true}).then((textContent) => {\n        return new Promise((resolve, reject) => {\n          // Render text layer for a11y of text content\n          let textLayer = page.querySelector(`.textLayer`);\n          let textLayerFactory = new pdfjsViewer.DefaultTextLayerFactory();\n          let textLayerBuilder = textLayerFactory.createTextLayerBuilder(textLayer, pageNumber -1, viewport);\n          textLayerBuilder.setTextContent(textContent);\n          textLayerBuilder.render();\n\n          // Enable a11y for annotations\n          // Timeout is needed to wait for `textLayerBuilder.render`\n          setTimeout(() => {\n            try {\n              renderScreenReaderHints(annotations.annotations);\n              resolve();\n            } catch (e) {\n              reject(e);\n            }\n          });\n        });\n      });\n    }).then(() => {\n      // Indicate that the page was loaded\n      page.setAttribute('data-loaded', 'true');\n\n      return [pdfPage, annotations];\n    });\n  });\n}\n\n/**\n * Scale the elements of a page.\n *\n * @param {Number} pageNumber The page number to be scaled\n * @param {Object} viewport The viewport of the PDF page (see pdfPage.getViewport(scale, rotate))\n * @param {Object} context The canvas context that the PDF page is rendered to\n * @return {Array} The transform data for rendering the PDF page\n */\nfunction scalePage(pageNumber, viewport, context) {\n  let page = document.getElementById(`pageContainer${pageNumber}`);\n  let canvas = page.querySelector('.canvasWrapper canvas');\n  let svg = page.querySelector('.annotationLayer');\n  let wrapper = page.querySelector('.canvasWrapper');\n  let textLayer = page.querySelector('.textLayer');\n  let outputScale = getOutputScale(context);\n  let transform = !outputScale.scaled ? null : [outputScale.sx, 0, 0, outputScale.sy, 0, 0];\n  let sfx = approximateFraction(outputScale.sx);\n  let sfy = approximateFraction(outputScale.sy);\n\n  // Adjust width/height for scale\n  page.style.visibility = '';\n  canvas.width = roundToDivide(viewport.width * outputScale.sx, sfx[0]);\n  canvas.height = roundToDivide(viewport.height * outputScale.sy, sfy[0]);\n  canvas.style.width = roundToDivide(viewport.width, sfx[1]) + 'px';\n  canvas.style.height = roundToDivide(viewport.height, sfx[1]) + 'px';\n  svg.setAttribute('width', viewport.width);\n  svg.setAttribute('height', viewport.height);\n  svg.style.width = `${viewport.width}px`;\n  svg.style.height = `${viewport.height}px`;\n  page.style.width = `${viewport.width}px`;\n  page.style.height = `${viewport.height}px`;\n  wrapper.style.width = `${viewport.width}px`;\n  wrapper.style.height = `${viewport.height}px`;\n  textLayer.style.width = `${viewport.width}px`;\n  textLayer.style.height = `${viewport.height}px`;\n\n  return transform;\n}\n\n/**\n * The following methods are taken from mozilla/pdf.js and as such fall under\n * the Apache License (http://www.apache.org/licenses/).\n *\n * Original source can be found at mozilla/pdf.js:\n * https://github.com/mozilla/pdf.js/blob/master/web/ui_utils.js\n */\n\n/**\n * Approximates a float number as a fraction using Farey sequence (max order\n * of 8).\n *\n * @param {Number} x Positive float number\n * @return {Array} Estimated fraction: the first array item is a numerator,\n *                 the second one is a denominator.\n */\nfunction approximateFraction(x) {\n  // Fast path for int numbers or their inversions.\n  if (Math.floor(x) === x) {\n    return [x, 1];\n  }\n\n  const xinv = 1 / x;\n  const limit = 8;\n  if (xinv > limit) {\n    return [1, limit];\n  } else if (Math.floor(xinv) === xinv) {\n    return [1, xinv];\n  }\n\n  const x_ = x > 1 ? xinv : x;\n\n  // a/b and c/d are neighbours in Farey sequence.\n  let a = 0, b = 1, c = 1, d = 1;\n\n  // Limit search to order 8.\n  while (true) {\n    // Generating next term in sequence (order of q).\n    let p = a + c, q = b + d;\n    if (q > limit) {\n      break;\n    }\n    if (x_ <= p / q) {\n      c = p; d = q;\n    } else {\n      a = p; b = q;\n    }\n  }\n\n  // Select closest of neighbours to x.\n  if (x_ - a / b < c / d - x_) {\n    return x_ === x ? [a, b] : [b, a];\n  } else {\n    return x_ === x ? [c, d] : [d, c];\n  }\n}\n\nfunction getOutputScale(ctx) {\n  let devicePixelRatio = window.devicePixelRatio || 1;\n  let backingStoreRatio = ctx.webkitBackingStorePixelRatio ||\n                          ctx.mozBackingStorePixelRatio ||\n                          ctx.msBackingStorePixelRatio ||\n                          ctx.oBackingStorePixelRatio ||\n                          ctx.backingStorePixelRatio || 1;\n  let pixelRatio = devicePixelRatio / backingStoreRatio;\n  return {\n    sx: pixelRatio,\n    sy: pixelRatio,\n    scaled: pixelRatio !== 1\n  };\n}\n\nfunction roundToDivide(x, div) {\n  let r = x % div;\n  return r === 0 ? x : Math.round(x - r + div);\n}\n","import { addEventListener, removeEventListener, fireEvent } from './event';\nimport { disableEdit, enableEdit } from './edit';\nimport { disablePen, enablePen, setPen } from './pen';\nimport { disablePoint, enablePoint, setPoint } from './point';\nimport { disableRect, enableRect, setHighlight, setStrikeout, setArea } from './rect';\nimport { disableText, enableText, setText } from './text';\nimport { createPage, renderPage } from './page';\n\nexport default {\n  addEventListener, removeEventListener, fireEvent,\n  disableEdit, enableEdit,\n  disablePen, enablePen, setPen,\n  disablePoint, enablePoint, setPoint,\n  disableRect, enableRect, setHighlight, setStrikeout, setArea,\n  disableText, enableText, setText,\n  createPage, renderPage\n};\n","import StoreAdapter from './adapter/StoreAdapter';\nimport LocalStoreAdapter from './adapter/LocalStoreAdapter';\nimport render from './render';\nimport UI from './UI';\n\nexport default {\n  /**\n   * Abstract class that needs to be defined so PDFJSAnnotate\n   * knows how to communicate with your server.\n   */\n  StoreAdapter,\n\n  /**\n   * Implementation of StoreAdapter that stores annotation data to localStorage.\n   */\n  LocalStoreAdapter,\n\n  /**\n   * Abstract instance of StoreAdapter\n   */\n  __storeAdapter: new StoreAdapter(),\n\n  /**\n   * Getter for the underlying StoreAdapter property\n   *\n   * @return {StoreAdapter}\n   */\n  getStoreAdapter() {\n    return this.__storeAdapter;\n  },\n\n  /**\n   * Setter for the underlying StoreAdapter property\n   *\n   * @param {StoreAdapter} adapter The StoreAdapter implementation to be used.\n   */\n  setStoreAdapter(adapter) {\n    // TODO this throws an error when bundled\n    // if (!(adapter instanceof StoreAdapter)) {\n    //   throw new Error('adapter must be an instance of StoreAdapter');\n    // }\n\n    this.__storeAdapter = adapter;\n  },\n\n  /**\n   * UI is a helper for instrumenting UI interactions for creating,\n   * editing, and deleting annotations in the browser.\n   */\n  UI,\n\n  /**\n   * Render the annotations for a page in the PDF Document\n   *\n   * @param {SVGElement} svg The SVG element that annotations should be rendered to\n   * @param {PageViewport} viewport The PDFPage.getViewport data\n   * @param {Object} data The StoreAdapter.getAnnotations data\n   * @return {Promise}\n   */\n  render,\n\n  /**\n   * Convenience method for getting annotation data\n   *\n   * @alias StoreAdapter.getAnnotations\n   * @param {String} documentId The ID of the document\n   * @param {String} pageNumber The page number\n   * @return {Promise}\n   */\n  getAnnotations(documentId, pageNumber) {\n    return this.getStoreAdapter().getAnnotations(...arguments);\n  }\n}\n","import PDFJSAnnotate from '../PDFJSAnnotate';\nimport appendChild from './appendChild';\nimport renderScreenReaderHints from '../a11y/renderScreenReaderHints';\n\n/**\n * Render the response from PDFJSAnnotate.getStoreAdapter().getAnnotations to SVG\n *\n * @param {SVGElement} svg The SVG element to render the annotations to\n * @param {Object} viewport The page viewport data\n * @param {Object} data The response from PDFJSAnnotate.getStoreAdapter().getAnnotations\n * @return {Promise} Settled once rendering has completed\n *  A settled Promise will be either:\n *    - fulfilled: SVGElement\n *    - rejected: Error\n */\nexport default function render(svg, viewport, data) {\n  return new Promise((resolve, reject) => {\n    // Reset the content of the SVG\n    svg.innerHTML = ''; \n    svg.setAttribute('data-pdf-annotate-container', true);\n    svg.setAttribute('data-pdf-annotate-viewport', JSON.stringify(viewport));\n    svg.removeAttribute('data-pdf-annotate-document');\n    svg.removeAttribute('data-pdf-annotate-page');\n\n    // If there's no data nothing can be done\n    if (!data) {\n      return resolve(svg);\n    }\n\n    svg.setAttribute('data-pdf-annotate-document', data.documentId);\n    svg.setAttribute('data-pdf-annotate-page', data.pageNumber);\n  \n    // Make sure annotations is an array\n    if (!Array.isArray(data.annotations) || data.annotations.length === 0) {\n      return resolve(svg);\n    }\n\n    // Append annotation to svg\n    data.annotations.forEach((a) => {\n      appendChild(svg, a, viewport);\n    });\n\n    resolve(svg);\n  });\n}\n","import PDFJSAnnotate from './src/PDFJSAnnotate';\n\nexport default PDFJSAnnotate;\n"],"sourceRoot":""}